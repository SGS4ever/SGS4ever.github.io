<!DOCTYPE html>
<html lang="en-us">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='ä»Šå¤©çœ‹çš„æ¼”è®²æ˜¯å…³äºæ•°æ®é©±åŠ¨è®¾è®¡ï¼ˆ Data-oriented Design, DoD ï¼‰çš„ï¼ŒçœŸä»¤æˆ‘å¤§å¼€çœ¼ç•Œã€‚è¿™ä¸ªè®¾è®¡æ€è·¯çš„æ€§èƒ½æ”¶ç›Šå¾ˆé«˜ï¼Œå¯è¯»æ€§ä¹Ÿå¾ˆå¥½ï¼Œå®åœ¨åº”è¯¥æ‰¾ä¸ªæœºä¼šç‹ ç‹ è½å®åˆ°å·¥ä½œä¸­ã€‚
Vittorioçš„æ¼”è®²é£æ ¼æŒºå¹²ç»ƒçš„ï¼Œtalk is cheapï¼Œå…¨ç¨‹å›´ç»•ä¸€ä¸ªå°Demoæ¥æ¼”ç»å¦‚ä½•é€šè¿‡DoDå®ç°å·¨å¤§çš„æ€§èƒ½ä¼˜åŒ–ã€‚
1 ä¸€ä¸ªç®€å•çš„Demo Demoæ˜¯ä¸€ä¸ªç®€å•çš„åœºæ™¯æ¨¡æ‹Ÿï¼Œè¦æ±‚åœ¨å±å¹•ä¸Šé£è¿‡ä¸€äº› å¯ä»¥å–·å°„ç²’å­ çš„ ç«ç®­ ï¼Œå¹¶ä¸ºäº†æ›´åŠ è´´è¿‘å®é™…ï¼Œé™„åŠ äº†å‡ ç‚¹éœ€æ±‚ï¼š
è¿åŠ¨æ¨¡æ‹Ÿï¼šç«ç®­éœ€è¦æ¨¡æ‹Ÿå‡ºä½ç½®ã€é€Ÿåº¦ã€åŠ é€Ÿåº¦ç­‰ æ•ˆæœï¼šä¸åŒç±»å‹çš„ç²’å­å’Œå‘å°„å™¨ï¼Œæ”¯æŒè‡ªå®šä¹‰å‚æ•°ï¼ˆé€æ˜åº¦ã€å¤§å°ã€æ—‹è½¬è§’ç­‰ï¼‰ å®ä½“ï¼šä¸ºäº†ä¾¿äºæ§åˆ¶å•ä¸ªå®ä½“ï¼Œç†è®ºä¸Šå¯ä»¥å»ºæ¨¡ä¸ºä¾‹å¦‚ç«ç®­&#43;å‘å°„å™¨ æ‰©å±•æ€§ï¼šä¾¿äºå¢åŠ æ–°çš„å®ä½“æˆ–æ•ˆæœ ä¸€ä¸ªç®€å•çš„å»ºæ¨¡ä¼šæ˜¯è¿™æ ·çš„ï¼ˆå…¶ä¸­æ·±è“è‰²ä¸ºå®ä½“ç±»ï¼Œæµ…è“è‰²ä¸ºæŠ½è±¡ç±»ï¼‰ï¼š
åœºæ™¯ä¸­æ‰€æœ‰çš„å¯¹è±¡éƒ½æ˜¯ä¸€ä¸ª å®ä½“ Entity å‘å°„å™¨å’Œç²’å­å¯ä»¥æœ‰ä¸åŒç±»å‹ï¼Œå¦‚ç«ç„°å‘å°„å™¨&amp;çƒŸé›¾å‘å°„å™¨ï¼Œå¯¹åº”ç«ç„°ç²’å­&amp;çƒŸé›¾ç²’å­ å¯¹è±¡çš„å®ç°å¯èƒ½æ˜¯è¿™æ ·çš„ï¼ˆç»“åˆä¸ªäººç†è§£ï¼Œå¯¹å£°æ˜é¡ºåºè¿›è¡Œäº†è°ƒæ•´ï¼Œä»¥ä¾¿å‘ˆç°æ€è·¯ï¼Œå…¶ä½™ä»£ç ç»†èŠ‚å‡ä¸æ¼”è®²ä¿æŒä¸€è‡´ï¼‰ï¼š
struct Entity { // 1 é¦–å…ˆå®ä½“åœ¨æˆ‘ä»¬çš„è®¾è®¡ä¸­æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œé€šå¸¸éœ€è¦è™šææ„å‡½æ•° virtual ~Entity() = default; // 2 å®ä½“éœ€è¦éµå¾ªç‰©ç†è§„å¾‹ï¼Œå› æ­¤æä¾›ä¸€äº›ç‰©ç†å±æ€§ï¼ˆä½ç½®ã€é€Ÿåº¦ã€åŠ é€Ÿåº¦ï¼‰ sf::Vector2f position; sf::Vector2f velocity; sf::Vector2f acceleration; // 3 å®ä½“éœ€è¦æ›´æ–°å’Œæ¸²æŸ“ virtual void update(float dt) { position &#43;= velocity * dt; velocity &#43;= acceleration * dt; } virtual void draw(sf::RenderTarget&amp;); // 4 å®ä½“éœ€è¦æ„ŸçŸ¥åˆ«çš„å®ä½“ï¼Œå› æ­¤ä¼šå¼•ç”¨ä¸–ç•Œå¯¹è±¡ï¼ŒåŒæ—¶ï¼Œå‘Šè¯‰ä¸–ç•Œè‡ªèº«æ˜¯å¦è¿˜å­˜æ´» World&amp; world; bool alive = true; }; ç²’å­çš„å®ç°ï¼Œåœ¨å®ä½“åŸºç¡€ä¸Šå¢åŠ äº†å¤§å°ã€é€æ˜åº¦å’Œæ—‹è½¬è§’ï¼ŒåŒæ—¶å½“é€æ˜åº¦é™ä¸º 0 æ—¶ï¼Œä¼šè‡ªåŠ¨é”€æ¯ï¼š
'><title>ã€cppcon25ã€‘Pratical Data-Oriented Design in C&#43;&#43;</title>

<link rel='canonical' href='https://xrg.fj.cn/p/cppcon25pratical-data-oriented-design-in-c-/'>

<link rel="stylesheet" href="/scss/style.min.744aa3042babb8291bcb36af694eb272f909f9b1e9c66387395b00d22da84726.css"><script src="https://apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script>

<script>
    
    $(window).scroll(function() {
    if ($(this).scrollTop()) {
        $('#back-to-top').fadeIn();
    } else {
        $('#back-to-top').fadeOut();
    }
    });

    
    $('#back-to-top').click(function() {
    $('html, body').animate({scrollTop: 0}, 1000);
    return false;
    });
</script>

<meta property='og:title' content='ã€cppcon25ã€‘Pratical Data-Oriented Design in C&#43;&#43;'>
<meta property='og:description' content='ä»Šå¤©çœ‹çš„æ¼”è®²æ˜¯å…³äºæ•°æ®é©±åŠ¨è®¾è®¡ï¼ˆ Data-oriented Design, DoD ï¼‰çš„ï¼ŒçœŸä»¤æˆ‘å¤§å¼€çœ¼ç•Œã€‚è¿™ä¸ªè®¾è®¡æ€è·¯çš„æ€§èƒ½æ”¶ç›Šå¾ˆé«˜ï¼Œå¯è¯»æ€§ä¹Ÿå¾ˆå¥½ï¼Œå®åœ¨åº”è¯¥æ‰¾ä¸ªæœºä¼šç‹ ç‹ è½å®åˆ°å·¥ä½œä¸­ã€‚
Vittorioçš„æ¼”è®²é£æ ¼æŒºå¹²ç»ƒçš„ï¼Œtalk is cheapï¼Œå…¨ç¨‹å›´ç»•ä¸€ä¸ªå°Demoæ¥æ¼”ç»å¦‚ä½•é€šè¿‡DoDå®ç°å·¨å¤§çš„æ€§èƒ½ä¼˜åŒ–ã€‚
1 ä¸€ä¸ªç®€å•çš„Demo Demoæ˜¯ä¸€ä¸ªç®€å•çš„åœºæ™¯æ¨¡æ‹Ÿï¼Œè¦æ±‚åœ¨å±å¹•ä¸Šé£è¿‡ä¸€äº› å¯ä»¥å–·å°„ç²’å­ çš„ ç«ç®­ ï¼Œå¹¶ä¸ºäº†æ›´åŠ è´´è¿‘å®é™…ï¼Œé™„åŠ äº†å‡ ç‚¹éœ€æ±‚ï¼š
è¿åŠ¨æ¨¡æ‹Ÿï¼šç«ç®­éœ€è¦æ¨¡æ‹Ÿå‡ºä½ç½®ã€é€Ÿåº¦ã€åŠ é€Ÿåº¦ç­‰ æ•ˆæœï¼šä¸åŒç±»å‹çš„ç²’å­å’Œå‘å°„å™¨ï¼Œæ”¯æŒè‡ªå®šä¹‰å‚æ•°ï¼ˆé€æ˜åº¦ã€å¤§å°ã€æ—‹è½¬è§’ç­‰ï¼‰ å®ä½“ï¼šä¸ºäº†ä¾¿äºæ§åˆ¶å•ä¸ªå®ä½“ï¼Œç†è®ºä¸Šå¯ä»¥å»ºæ¨¡ä¸ºä¾‹å¦‚ç«ç®­&#43;å‘å°„å™¨ æ‰©å±•æ€§ï¼šä¾¿äºå¢åŠ æ–°çš„å®ä½“æˆ–æ•ˆæœ ä¸€ä¸ªç®€å•çš„å»ºæ¨¡ä¼šæ˜¯è¿™æ ·çš„ï¼ˆå…¶ä¸­æ·±è“è‰²ä¸ºå®ä½“ç±»ï¼Œæµ…è“è‰²ä¸ºæŠ½è±¡ç±»ï¼‰ï¼š
åœºæ™¯ä¸­æ‰€æœ‰çš„å¯¹è±¡éƒ½æ˜¯ä¸€ä¸ª å®ä½“ Entity å‘å°„å™¨å’Œç²’å­å¯ä»¥æœ‰ä¸åŒç±»å‹ï¼Œå¦‚ç«ç„°å‘å°„å™¨&amp;çƒŸé›¾å‘å°„å™¨ï¼Œå¯¹åº”ç«ç„°ç²’å­&amp;çƒŸé›¾ç²’å­ å¯¹è±¡çš„å®ç°å¯èƒ½æ˜¯è¿™æ ·çš„ï¼ˆç»“åˆä¸ªäººç†è§£ï¼Œå¯¹å£°æ˜é¡ºåºè¿›è¡Œäº†è°ƒæ•´ï¼Œä»¥ä¾¿å‘ˆç°æ€è·¯ï¼Œå…¶ä½™ä»£ç ç»†èŠ‚å‡ä¸æ¼”è®²ä¿æŒä¸€è‡´ï¼‰ï¼š
struct Entity { // 1 é¦–å…ˆå®ä½“åœ¨æˆ‘ä»¬çš„è®¾è®¡ä¸­æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œé€šå¸¸éœ€è¦è™šææ„å‡½æ•° virtual ~Entity() = default; // 2 å®ä½“éœ€è¦éµå¾ªç‰©ç†è§„å¾‹ï¼Œå› æ­¤æä¾›ä¸€äº›ç‰©ç†å±æ€§ï¼ˆä½ç½®ã€é€Ÿåº¦ã€åŠ é€Ÿåº¦ï¼‰ sf::Vector2f position; sf::Vector2f velocity; sf::Vector2f acceleration; // 3 å®ä½“éœ€è¦æ›´æ–°å’Œæ¸²æŸ“ virtual void update(float dt) { position &#43;= velocity * dt; velocity &#43;= acceleration * dt; } virtual void draw(sf::RenderTarget&amp;); // 4 å®ä½“éœ€è¦æ„ŸçŸ¥åˆ«çš„å®ä½“ï¼Œå› æ­¤ä¼šå¼•ç”¨ä¸–ç•Œå¯¹è±¡ï¼ŒåŒæ—¶ï¼Œå‘Šè¯‰ä¸–ç•Œè‡ªèº«æ˜¯å¦è¿˜å­˜æ´» World&amp; world; bool alive = true; }; ç²’å­çš„å®ç°ï¼Œåœ¨å®ä½“åŸºç¡€ä¸Šå¢åŠ äº†å¤§å°ã€é€æ˜åº¦å’Œæ—‹è½¬è§’ï¼ŒåŒæ—¶å½“é€æ˜åº¦é™ä¸º 0 æ—¶ï¼Œä¼šè‡ªåŠ¨é”€æ¯ï¼š
'>
<meta property='og:url' content='https://xrg.fj.cn/p/cppcon25pratical-data-oriented-design-in-c-/'>
<meta property='og:site_name' content='XR_G&#39;s Blog'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='æŠ€æœ¯' /><meta property='article:published_time' content='2025-09-27T00:00:00&#43;00:00'/><meta property='article:modified_time' content='2025-09-27T00:00:00&#43;00:00'/>
<meta name="twitter:title" content="ã€cppcon25ã€‘Pratical Data-Oriented Design in C&#43;&#43;">
<meta name="twitter:description" content="ä»Šå¤©çœ‹çš„æ¼”è®²æ˜¯å…³äºæ•°æ®é©±åŠ¨è®¾è®¡ï¼ˆ Data-oriented Design, DoD ï¼‰çš„ï¼ŒçœŸä»¤æˆ‘å¤§å¼€çœ¼ç•Œã€‚è¿™ä¸ªè®¾è®¡æ€è·¯çš„æ€§èƒ½æ”¶ç›Šå¾ˆé«˜ï¼Œå¯è¯»æ€§ä¹Ÿå¾ˆå¥½ï¼Œå®åœ¨åº”è¯¥æ‰¾ä¸ªæœºä¼šç‹ ç‹ è½å®åˆ°å·¥ä½œä¸­ã€‚
Vittorioçš„æ¼”è®²é£æ ¼æŒºå¹²ç»ƒçš„ï¼Œtalk is cheapï¼Œå…¨ç¨‹å›´ç»•ä¸€ä¸ªå°Demoæ¥æ¼”ç»å¦‚ä½•é€šè¿‡DoDå®ç°å·¨å¤§çš„æ€§èƒ½ä¼˜åŒ–ã€‚
1 ä¸€ä¸ªç®€å•çš„Demo Demoæ˜¯ä¸€ä¸ªç®€å•çš„åœºæ™¯æ¨¡æ‹Ÿï¼Œè¦æ±‚åœ¨å±å¹•ä¸Šé£è¿‡ä¸€äº› å¯ä»¥å–·å°„ç²’å­ çš„ ç«ç®­ ï¼Œå¹¶ä¸ºäº†æ›´åŠ è´´è¿‘å®é™…ï¼Œé™„åŠ äº†å‡ ç‚¹éœ€æ±‚ï¼š
è¿åŠ¨æ¨¡æ‹Ÿï¼šç«ç®­éœ€è¦æ¨¡æ‹Ÿå‡ºä½ç½®ã€é€Ÿåº¦ã€åŠ é€Ÿåº¦ç­‰ æ•ˆæœï¼šä¸åŒç±»å‹çš„ç²’å­å’Œå‘å°„å™¨ï¼Œæ”¯æŒè‡ªå®šä¹‰å‚æ•°ï¼ˆé€æ˜åº¦ã€å¤§å°ã€æ—‹è½¬è§’ç­‰ï¼‰ å®ä½“ï¼šä¸ºäº†ä¾¿äºæ§åˆ¶å•ä¸ªå®ä½“ï¼Œç†è®ºä¸Šå¯ä»¥å»ºæ¨¡ä¸ºä¾‹å¦‚ç«ç®­&#43;å‘å°„å™¨ æ‰©å±•æ€§ï¼šä¾¿äºå¢åŠ æ–°çš„å®ä½“æˆ–æ•ˆæœ ä¸€ä¸ªç®€å•çš„å»ºæ¨¡ä¼šæ˜¯è¿™æ ·çš„ï¼ˆå…¶ä¸­æ·±è“è‰²ä¸ºå®ä½“ç±»ï¼Œæµ…è“è‰²ä¸ºæŠ½è±¡ç±»ï¼‰ï¼š
åœºæ™¯ä¸­æ‰€æœ‰çš„å¯¹è±¡éƒ½æ˜¯ä¸€ä¸ª å®ä½“ Entity å‘å°„å™¨å’Œç²’å­å¯ä»¥æœ‰ä¸åŒç±»å‹ï¼Œå¦‚ç«ç„°å‘å°„å™¨&amp;çƒŸé›¾å‘å°„å™¨ï¼Œå¯¹åº”ç«ç„°ç²’å­&amp;çƒŸé›¾ç²’å­ å¯¹è±¡çš„å®ç°å¯èƒ½æ˜¯è¿™æ ·çš„ï¼ˆç»“åˆä¸ªäººç†è§£ï¼Œå¯¹å£°æ˜é¡ºåºè¿›è¡Œäº†è°ƒæ•´ï¼Œä»¥ä¾¿å‘ˆç°æ€è·¯ï¼Œå…¶ä½™ä»£ç ç»†èŠ‚å‡ä¸æ¼”è®²ä¿æŒä¸€è‡´ï¼‰ï¼š
struct Entity { // 1 é¦–å…ˆå®ä½“åœ¨æˆ‘ä»¬çš„è®¾è®¡ä¸­æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œé€šå¸¸éœ€è¦è™šææ„å‡½æ•° virtual ~Entity() = default; // 2 å®ä½“éœ€è¦éµå¾ªç‰©ç†è§„å¾‹ï¼Œå› æ­¤æä¾›ä¸€äº›ç‰©ç†å±æ€§ï¼ˆä½ç½®ã€é€Ÿåº¦ã€åŠ é€Ÿåº¦ï¼‰ sf::Vector2f position; sf::Vector2f velocity; sf::Vector2f acceleration; // 3 å®ä½“éœ€è¦æ›´æ–°å’Œæ¸²æŸ“ virtual void update(float dt) { position &#43;= velocity * dt; velocity &#43;= acceleration * dt; } virtual void draw(sf::RenderTarget&amp;); // 4 å®ä½“éœ€è¦æ„ŸçŸ¥åˆ«çš„å®ä½“ï¼Œå› æ­¤ä¼šå¼•ç”¨ä¸–ç•Œå¯¹è±¡ï¼ŒåŒæ—¶ï¼Œå‘Šè¯‰ä¸–ç•Œè‡ªèº«æ˜¯å¦è¿˜å­˜æ´» World&amp; world; bool alive = true; }; ç²’å­çš„å®ç°ï¼Œåœ¨å®ä½“åŸºç¡€ä¸Šå¢åŠ äº†å¤§å°ã€é€æ˜åº¦å’Œæ—‹è½¬è§’ï¼ŒåŒæ—¶å½“é€æ˜åº¦é™ä¸º 0 æ—¶ï¼Œä¼šè‡ªåŠ¨é”€æ¯ï¼š
">
    <link rel="shortcut icon" href="/favicon.ico" />

    </head>
    <body class="
    article-page has-toc
">
        <div id="loading-box">
                
                <div class="loading-left-bg"></div>
                <div class="loading-right-bg"></div>
                
                <div class="spinner-box">
                        <div class="configure-border-1">
                                <div class="configure-core"></div>
                        </div>
                        <div class="configure-border-2">
                                <div class="configure-core"></div>
                        </div>
                        <div class="loading-word">åŠ è½½ä¸­...</div>
                </div>
      </div>
      
      <script>
        $(document).ready(function () {
                
                document.getElementById('loading-box').classList.add("loaded")
        })
      </script>

    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex 
    
        extended
    
">
    
        <div id="article-toolbar">
            <a href="/" class="back-home">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="15 6 9 12 15 18" />
</svg>



                <span>è¿”å›</span>
            </a>
        </div>
    
<main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    

    <h2 class="article-title">
        <a href="/p/cppcon25pratical-data-oriented-design-in-c-/">ã€cppcon25ã€‘Pratical Data-Oriented Design in C&#43;&#43;</a>
    </h2>

    

    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Sep 27, 2025</time>
            </div>
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    é˜…è¯»æ—¶é•¿: 6 åˆ†é’Ÿ
                </time>
            </div>
        
    </footer>
    
</div>
</header>

    <section class="article-content">
    <p>ä»Šå¤©çœ‹çš„æ¼”è®²æ˜¯å…³äºæ•°æ®é©±åŠ¨è®¾è®¡ï¼ˆ <em>Data-oriented Design, DoD</em> ï¼‰çš„ï¼ŒçœŸä»¤æˆ‘å¤§å¼€çœ¼ç•Œã€‚è¿™ä¸ªè®¾è®¡æ€è·¯çš„æ€§èƒ½æ”¶ç›Šå¾ˆé«˜ï¼Œå¯è¯»æ€§ä¹Ÿå¾ˆå¥½ï¼Œå®åœ¨åº”è¯¥æ‰¾ä¸ªæœºä¼šç‹ ç‹ è½å®åˆ°å·¥ä½œä¸­ã€‚</p>
<p>Vittorioçš„æ¼”è®²é£æ ¼æŒºå¹²ç»ƒçš„ï¼Œtalk is cheapï¼Œå…¨ç¨‹å›´ç»•ä¸€ä¸ªå°Demoæ¥æ¼”ç»å¦‚ä½•é€šè¿‡DoDå®ç°å·¨å¤§çš„æ€§èƒ½ä¼˜åŒ–ã€‚</p>
<h3 id="1-ä¸€ä¸ªç®€å•çš„demo">1 ä¸€ä¸ªç®€å•çš„Demo</h3>
<p>Demoæ˜¯ä¸€ä¸ªç®€å•çš„åœºæ™¯æ¨¡æ‹Ÿï¼Œè¦æ±‚åœ¨å±å¹•ä¸Šé£è¿‡ä¸€äº› <em>å¯ä»¥å–·å°„ç²’å­</em> çš„ <em>ç«ç®­</em> ï¼Œå¹¶ä¸ºäº†æ›´åŠ è´´è¿‘å®é™…ï¼Œé™„åŠ äº†å‡ ç‚¹éœ€æ±‚ï¼š</p>
<ul>
<li>è¿åŠ¨æ¨¡æ‹Ÿï¼šç«ç®­éœ€è¦æ¨¡æ‹Ÿå‡ºä½ç½®ã€é€Ÿåº¦ã€åŠ é€Ÿåº¦ç­‰</li>
<li>æ•ˆæœï¼šä¸åŒç±»å‹çš„ç²’å­å’Œå‘å°„å™¨ï¼Œæ”¯æŒè‡ªå®šä¹‰å‚æ•°ï¼ˆé€æ˜åº¦ã€å¤§å°ã€æ—‹è½¬è§’ç­‰ï¼‰</li>
<li>å®ä½“ï¼šä¸ºäº†ä¾¿äºæ§åˆ¶å•ä¸ªå®ä½“ï¼Œç†è®ºä¸Šå¯ä»¥å»ºæ¨¡ä¸ºä¾‹å¦‚ç«ç®­+å‘å°„å™¨</li>
<li>æ‰©å±•æ€§ï¼šä¾¿äºå¢åŠ æ–°çš„å®ä½“æˆ–æ•ˆæœ</li>
</ul>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 137; 
			flex-basis: 329px"
	>
	<a href="/p/cppcon25pratical-data-oriented-design-in-c-/1.png" data-size="1067x778">
		<img src="/p/cppcon25pratical-data-oriented-design-in-c-/1.png"
			width="1067"
			height="778"
			srcset="/p/cppcon25pratical-data-oriented-design-in-c-/1_hu5410305169650136899.png 480w, /p/cppcon25pratical-data-oriented-design-in-c-/1_hu10257298369898371339.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>ä¸€ä¸ªç®€å•çš„å»ºæ¨¡ä¼šæ˜¯è¿™æ ·çš„ï¼ˆå…¶ä¸­æ·±è“è‰²ä¸ºå®ä½“ç±»ï¼Œæµ…è“è‰²ä¸ºæŠ½è±¡ç±»ï¼‰ï¼š</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 181; 
			flex-basis: 436px"
	>
	<a href="/p/cppcon25pratical-data-oriented-design-in-c-/2.png" data-size="1502x826">
		<img src="/p/cppcon25pratical-data-oriented-design-in-c-/2.png"
			width="1502"
			height="826"
			srcset="/p/cppcon25pratical-data-oriented-design-in-c-/2_hu2386365465619707563.png 480w, /p/cppcon25pratical-data-oriented-design-in-c-/2_hu17582678550926521366.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<ul>
<li>åœºæ™¯ä¸­æ‰€æœ‰çš„å¯¹è±¡éƒ½æ˜¯ä¸€ä¸ª <em>å®ä½“</em> <code>Entity</code></li>
<li>å‘å°„å™¨å’Œç²’å­å¯ä»¥æœ‰ä¸åŒç±»å‹ï¼Œå¦‚ç«ç„°å‘å°„å™¨&amp;çƒŸé›¾å‘å°„å™¨ï¼Œå¯¹åº”ç«ç„°ç²’å­&amp;çƒŸé›¾ç²’å­</li>
</ul>
<p>å¯¹è±¡çš„å®ç°å¯èƒ½æ˜¯è¿™æ ·çš„ï¼ˆç»“åˆä¸ªäººç†è§£ï¼Œå¯¹å£°æ˜é¡ºåºè¿›è¡Œäº†è°ƒæ•´ï¼Œä»¥ä¾¿å‘ˆç°æ€è·¯ï¼Œå…¶ä½™ä»£ç ç»†èŠ‚å‡ä¸æ¼”è®²ä¿æŒä¸€è‡´ï¼‰ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Entity</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 1 é¦–å…ˆå®ä½“åœ¨æˆ‘ä»¬çš„è®¾è®¡ä¸­æ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œé€šå¸¸éœ€è¦è™šææ„å‡½æ•°
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">virtual</span> <span class="o">~</span><span class="n">Entity</span><span class="p">()</span> <span class="o">=</span> <span class="k">default</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 2 å®ä½“éœ€è¦éµå¾ªç‰©ç†è§„å¾‹ï¼Œå› æ­¤æä¾›ä¸€äº›ç‰©ç†å±æ€§ï¼ˆä½ç½®ã€é€Ÿåº¦ã€åŠ é€Ÿåº¦ï¼‰
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">sf</span><span class="o">::</span><span class="n">Vector2f</span> <span class="n">position</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">sf</span><span class="o">::</span><span class="n">Vector2f</span> <span class="n">velocity</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">sf</span><span class="o">::</span><span class="n">Vector2f</span> <span class="n">acceleration</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 3 å®ä½“éœ€è¦æ›´æ–°å’Œæ¸²æŸ“
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span><span class="kt">float</span> <span class="n">dt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">position</span> <span class="o">+=</span> <span class="n">velocity</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">velocity</span> <span class="o">+=</span> <span class="n">acceleration</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="n">sf</span><span class="o">::</span><span class="n">RenderTarget</span><span class="o">&amp;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 4 å®ä½“éœ€è¦æ„ŸçŸ¥åˆ«çš„å®ä½“ï¼Œå› æ­¤ä¼šå¼•ç”¨ä¸–ç•Œå¯¹è±¡ï¼ŒåŒæ—¶ï¼Œå‘Šè¯‰ä¸–ç•Œè‡ªèº«æ˜¯å¦è¿˜å­˜æ´»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">World</span><span class="o">&amp;</span> <span class="n">world</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">bool</span> <span class="n">alive</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>ç²’å­çš„å®ç°ï¼Œåœ¨å®ä½“åŸºç¡€ä¸Šå¢åŠ äº†å¤§å°ã€é€æ˜åº¦å’Œæ—‹è½¬è§’ï¼ŒåŒæ—¶å½“é€æ˜åº¦é™ä¸º <code>0</code> æ—¶ï¼Œä¼šè‡ªåŠ¨é”€æ¯ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Particle</span> <span class="o">:</span> <span class="n">Entity</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">scale</span><span class="err">ï¼Œ</span> <span class="n">scaleRate</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">opacity</span><span class="p">,</span> <span class="n">opacityChange</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">rotation</span><span class="p">,</span> <span class="n">angularVelocity</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span><span class="kt">float</span> <span class="n">dt</span><span class="p">)</span> <span class="k">override</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">Entity</span><span class="o">::</span><span class="n">update</span><span class="p">(</span><span class="n">dt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">scale</span> <span class="o">+=</span> <span class="n">scaleRate</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">opacity</span> <span class="o">+=</span> <span class="n">opacityChange</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">rotation</span> <span class="o">+=</span> <span class="n">angularVelocity</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">alive</span> <span class="o">=</span> <span class="n">opacity</span> <span class="o">&gt;</span> <span class="mf">0.0f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>å…·ä½“ç²’å­çš„å®ç°ï¼Œå¦‚çƒŸé›¾ç²’å­ï¼Œåªæ˜¯ä½¿ç”¨ç‰¹å®šçº¹ç†å®ç°äº†æ¸²æŸ“èƒ½åŠ›ï¼Œæ¼”è®²ä¸­æ²¡æœ‰ç»™å‡ºå…·ä½“å®ç°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">SmokeParticle</span> <span class="o">:</span> <span class="n">Particle</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="n">sf</span><span class="o">::</span><span class="n">RenderTarget</span><span class="o">&amp;</span> <span class="n">target</span><span class="p">)</span> <span class="k">override</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ... draw using smoke texture ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>æ‰€æœ‰çš„å®ä½“ä¿å­˜åœ¨ä¸–ç•Œä¸­ï¼Œä¸–ç•Œå¯¹è±¡ä¼šç®¡ç†æ‰€æœ‰å®ä½“ï¼Œå¹¶è°ƒç”¨æ¯ä¸ªå®ä½“çš„æ›´æ–°å’Œæ¸²æŸ“æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">World</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">unique_ptr</span><span class="o">&lt;</span><span class="n">Entity</span><span class="o">&gt;&gt;</span> <span class="n">entities</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span><span class="kt">float</span> <span class="n">dt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="nl">entity</span> <span class="p">:</span> <span class="n">entities</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">entity</span><span class="o">-&gt;</span><span class="n">update</span><span class="p">(</span><span class="n">dt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="n">sf</span><span class="o">::</span><span class="n">RenderTarget</span><span class="o">&amp;</span> <span class="n">target</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="nl">entity</span> <span class="p">:</span> <span class="n">entities</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">entity</span><span class="o">-&gt;</span><span class="n">draw</span><span class="p">(</span><span class="n">target</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">cleanup</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">std</span><span class="o">::</span><span class="n">erase_if</span><span class="p">(</span><span class="n">entities</span><span class="p">,</span> <span class="p">[](</span><span class="k">const</span> <span class="k">auto</span><span class="o">&amp;</span> <span class="n">entity</span><span class="p">)</span> <span class="p">{</span> <span class="k">return</span> <span class="o">!</span><span class="n">entity</span><span class="o">-&gt;</span><span class="n">alive</span><span class="p">;</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>å‘å°„å™¨çš„åŠŸèƒ½å°±æ˜¯å®šæœŸå‘å°„ç²’å­ï¼Œè€Œå…·ä½“å‘å°„å™¨çš„å®ç°ï¼Œå¦‚çƒŸé›¾å‘å°„å™¨ï¼Œåªæ˜¯ç”Ÿæˆä¸€ä¸ªç²’å­å¯¹è±¡ï¼Œå¹¶æ·»åŠ åˆ°ä¸–ç•Œä¸­ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Emitter</span> <span class="o">:</span> <span class="n">Entity</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">spawnTimer</span><span class="p">,</span> <span class="n">spawnRate</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">spawnParticle</span><span class="p">()</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span><span class="kt">float</span> <span class="n">dt</span><span class="p">)</span> <span class="k">override</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ... periodically call `spawnParticle()` ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">SmokeEmitter</span> <span class="o">:</span> <span class="n">Emitter</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">spawnParticle</span><span class="p">()</span> <span class="k">override</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// è¿™é‡Œçš„ä»£ç å’Œæ¼”è®²é‡Œçš„ä»£ç ç¨æœ‰ä¸åŒï¼Œæˆ‘è®¤ä¸ºè¿™ä¸ªå®ç°æ‰å¯¹
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="c1">// æ¼”è®²çš„ä»£ç é‡ŒæŠŠ `world` å½“æŒ‡é’ˆç”¨ï¼Œä½†å®é™…ä¸Šåœ¨ Entity çš„å®šä¹‰ä¸­ï¼Œ `world` æ˜¯ä¸€ä¸ªå¼•ç”¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">world</span><span class="p">.</span><span class="n">entities</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">make_unique</span><span class="o">&lt;</span><span class="n">SmokeParticle</span><span class="o">&gt;</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>æœ€åä¸€ä¸ªå®ä½“æ˜¯ç«ç®­ï¼Œå®ƒå’Œå‘å°„å™¨çš„å…³ç³»æ˜¯ç»„åˆå…³ç³»ï¼Œå®ƒçš„ç§»åŠ¨ä¼šå¸¦ç€å‘å°„å™¨ç§»åŠ¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Rocket</span> <span class="o">:</span> <span class="n">Entity</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// å› ä¸ºèƒ½å¤Ÿä¿è¯ç”Ÿå‘½å‘¨æœŸï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨è£¸æŒ‡é’ˆ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">SmokeEmitter</span> <span class="o">*</span><span class="n">smokeEmitter</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">FireEmitter</span> <span class="o">*</span><span class="n">fireEmitter</span> <span class="o">=</span> <span class="k">nullptr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Rocket</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ... create emitters ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span><span class="kt">float</span> <span class="n">dt</span><span class="p">)</span> <span class="k">override</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ... move emitters with rocket ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><blockquote>
<p>ä¸Šè¿°çš„å®ç°æœ‰äº›åœ°æ–¹ä¹Ÿç¦ä¸èµ·ä¸¥æ ¼æ¨æ•²ï¼Œä¾‹å¦‚ <code>Entity::update</code> å®ç°äº†ç§»åŠ¨ï¼Œä½† <code>Emitter::update</code> è¡Œä¸ºå’Œå®ƒçš„åŸºç±»å®Œå…¨ä¸ä¸€æ ·â€¦ whateverï¼Œè¿™ä¸ªå®ç°è¿˜æ˜¯æ¯”è¾ƒOOP styleçš„</p>
</blockquote>
<p>ä½œè€…çš„benckmarkæµ‹è¯•ç»“æœå¦‚ä¸‹ï¼Œæ¨ªè½´ä¸ºä¸åŒå®ä½“æ•°é‡ï¼Œçºµè½´ä¸ºupdateæ¶ˆè€—çš„æ—¶é—´ï¼š</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 179; 
			flex-basis: 430px"
	>
	<a href="/p/cppcon25pratical-data-oriented-design-in-c-/3.png" data-size="1522x849">
		<img src="/p/cppcon25pratical-data-oriented-design-in-c-/3.png"
			width="1522"
			height="849"
			srcset="/p/cppcon25pratical-data-oriented-design-in-c-/3_hu6696551923100701951.png 480w, /p/cppcon25pratical-data-oriented-design-in-c-/3_hu4248200274122669967.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>çœ‹ä¸Šå»è¿˜å¯ä»¥çš„è¡¨ç°ï¼Œä½†åˆè€ƒè™‘åˆ°ä¸¤ä¸ªæ•°æ®ï¼š</p>
<ul>
<li><code>60FPS = ~16.67ms</code></li>
<li><code>144FPS = ~6.94ms</code></li>
</ul>
<p>ğŸ˜²ğŸ¥²ï¼è¿™æ ·çœ‹æ¥ï¼Œä¸ºäº†æµç•…è¿è¡Œï¼Œæ¯ä¸€å¸§ç•™ç»™å¼€å‘è€…çš„æ—¶é—´çœŸçš„éå¸¸çŸ­ï¼Œå¸¸è§„å®ç°çš„æ€§èƒ½é—®é¢˜éå¸¸ä¹‹æ˜¾è‘—ã€‚</p>
<h3 id="2-é¢˜å¤–è¯å†…å­˜å’Œcache">2 é¢˜å¤–è¯ï¼šå†…å­˜å’ŒCache</h3>
<p>è¿™ä¸€èŠ‚ä¸æ‰“ç®—è·Ÿç€æ¼”è®²è¯¦ç»†è®°å½•ï¼Œä»…æ‘˜å½•ä¸€äº›é‡è¦çš„ç‚¹ã€‚</p>
<ul>
<li><em>Cache line</em> æ˜¯æœ€å°çš„å†…å­˜ä¼ è¾“å•å…ƒï¼šå³ä½¿æˆ‘ä»¬åªéœ€è¦ä¸€ä¸ªå­—èŠ‚çš„æ•°æ®ï¼Œå†…å­˜ä¹Ÿæ˜¯æŒ‰ç…§æ•´è¡Œè¯»å…¥çš„ï¼›å› æ­¤æ›´å®œä½¿ç”¨è¿ç»­å†…å­˜ï¼Œä¸”æŒ‰ç…§åˆ©äºCPUé¢„æµ‹çš„æ–¹å¼è¿›è¡Œæ•°æ®è®¿é—®ï¼›</li>
</ul>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 182; 
			flex-basis: 436px"
	>
	<a href="/p/cppcon25pratical-data-oriented-design-in-c-/4.png" data-size="1511x830">
		<img src="/p/cppcon25pratical-data-oriented-design-in-c-/4.png"
			width="1511"
			height="830"
			srcset="/p/cppcon25pratical-data-oriented-design-in-c-/4_hu3006604439347195105.png 480w, /p/cppcon25pratical-data-oriented-design-in-c-/4_hu11840952683576943485.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<h3 id="3-oopå®ç°çš„æ€§èƒ½é—®é¢˜åˆ†æ">3 OOPå®ç°çš„æ€§èƒ½é—®é¢˜åˆ†æ</h3>
<ol>
<li>ä¸–ç•Œå¯¹è±¡ä¸­ä½¿ç”¨çš„æ˜¯å®ä½“çš„æŒ‡é’ˆï¼Œå³ï¼Œå†…å­˜ä¸­å®ä½“çš„åˆ†å¸ƒå¯èƒ½æ˜¯åˆ†æ•£çš„ï¼Œè¿™å¯¼è‡´äº†å‡ ä¹æ¯æ¬¡è¿­ä»£éƒ½å¯èƒ½äº§ç”ŸCache Miss</li>
<li>æ¯æ¬¡è°ƒç”¨å®ä½“çš„ <code>update</code> æ–¹æ³•éƒ½éœ€è¦è¿›è¡Œè™šå‡½æ•°çš„åŠ¨æ€åˆ†å‘ï¼ˆè¿è¡Œæ—¶å¤šæ€ï¼Œä¾èµ–è™šè¡¨æŸ¥æ‰¾çœŸæ­£çš„å®ç°ï¼‰</li>
<li>è¾ƒå¤šçš„å†…å­˜ç”³è¯·/é‡Šæ”¾</li>
</ol>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 179; 
			flex-basis: 430px"
	>
	<a href="/p/cppcon25pratical-data-oriented-design-in-c-/5.png" data-size="1518x846">
		<img src="/p/cppcon25pratical-data-oriented-design-in-c-/5.png"
			width="1518"
			height="846"
			srcset="/p/cppcon25pratical-data-oriented-design-in-c-/5_hu7351305689579101415.png 480w, /p/cppcon25pratical-data-oriented-design-in-c-/5_hu2237564057126370495.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<h3 id="4-è®¾è®¡å“²å­¦çš„å¯¹æ¯”">4 è®¾è®¡å“²å­¦çš„å¯¹æ¯”</h3>
<p>ä»è®¾è®¡å“²å­¦æ¥çœ‹ï¼Œæœ€åˆçš„å®ç°è™½ç„¶å­˜åœ¨æ€§èƒ½é—®é¢˜ï¼Œä½†åŸºæœ¬ä¸Šå·²ç»ç¬¦åˆOOPçš„è®¾è®¡å“²å­¦ï¼š</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 180; 
			flex-basis: 432px"
	>
	<a href="/p/cppcon25pratical-data-oriented-design-in-c-/6.png" data-size="1507x836">
		<img src="/p/cppcon25pratical-data-oriented-design-in-c-/6.png"
			width="1507"
			height="836"
			srcset="/p/cppcon25pratical-data-oriented-design-in-c-/6_hu13626525986782113667.png 480w, /p/cppcon25pratical-data-oriented-design-in-c-/6_hu15220238138771443978.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<ul>
<li>ä¸–ç•Œç”±å¯¹è±¡ç»„æˆ</li>
<li>é€šè¿‡æ¶ˆæ¯ä¼ é€’è¿›è¡Œäº¤æµ</li>
<li>æš´éœ²è¡Œä¸ºã€éšè—æ•°æ®</li>
<li>è§„åˆ’æœªçŸ¥çš„éœ€æ±‚</li>
</ul>
<blockquote>
<p>Vittorioè¯´è¿™ä¸ª <em>bet</em> ï¼ˆèµŒæ³¨ï¼‰ä¸€è¯æ˜¯ä»–ç²¾å¿ƒå®‰æ’çš„ï¼Œæˆ‘ä¸€å®šç¨‹åº¦ä¸ŠåŒæ„ã€‚OOPçš„åŸºç±»ï¼Œæ¯ä¸€ä¸ªæ–¹æ³•éƒ½åœ¨èµŒè‡ªå·±å¯¹äºä¸–ç•Œçš„æè¿°æ˜¯æ­£ç¡®çš„ï¼›åç»­æ‰©å±•å‡ºæ¥çš„å­ç±»ï¼Œæ»¡è¶³åŸºç±»çš„è®¾è®¡åˆ™çš†å¤§æ¬¢å–œï¼Œä¸æ»¡è¶³åŸºç±»çš„è®¾è®¡åˆ™æ‹–æ³¥å¸¦æ°´åœ°æ”¹åŠ¨ã€‚è¿™ä¸æ˜¯è¯´OOPæœ¬èº«æœ‰é—®é¢˜ï¼Œè€Œæ˜¯åœ¨å®è·µä¸­è¿™å¤ªè¿‡äºè€ƒéªŒå¼€å‘äººå‘˜çš„è®¾è®¡æ°´å¹³ï¼Œè°åˆèƒ½è¦æ±‚æ¯ä¸ªäººéƒ½æ˜¯å¤§proå‘¢ï¼Ÿ</p>
</blockquote>
<p>ç›¸æ¯”ä¹‹ä¸‹ï¼Œé¢å‘æ•°æ®çš„è®¾è®¡å“²å­¦å¯èƒ½æ˜¯è¿™æ ·çš„ï¼š</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 180; 
			flex-basis: 432px"
	>
	<a href="/p/cppcon25pratical-data-oriented-design-in-c-/7.png" data-size="1503x835">
		<img src="/p/cppcon25pratical-data-oriented-design-in-c-/7.png"
			width="1503"
			height="835"
			srcset="/p/cppcon25pratical-data-oriented-design-in-c-/7_hu2318994575623631177.png 480w, /p/cppcon25pratical-data-oriented-design-in-c-/7_hu17420241732183230488.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<ul>
<li>ä¸–ç•Œç”±æ•°æ®ç»„æˆï¼Œä»£ç çš„ä½œç”¨æ˜¯æŠŠæ•°æ®ä»ä¸€ä¸ªçŠ¶æ€è½¬æ¢åˆ°å¦ä¸€ä¸ªçŠ¶æ€</li>
<li>ç›´æ¥æ“ä½œæ‰¹é‡æ•°æ®</li>
<li>æš´éœ²æ•°æ®ï¼Œé›†ä¸­è¡Œä¸º</li>
<li>è§„åˆ’å½“ä¸‹</li>
</ul>
<p>è½¬å˜æ€è·¯çš„å…³é”®ï¼š</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 176; 
			flex-basis: 423px"
	>
	<a href="/p/cppcon25pratical-data-oriented-design-in-c-/8.png" data-size="1434x812">
		<img src="/p/cppcon25pratical-data-oriented-design-in-c-/8.png"
			width="1434"
			height="812"
			srcset="/p/cppcon25pratical-data-oriented-design-in-c-/8_hu10384310888831867967.png 480w, /p/cppcon25pratical-data-oriented-design-in-c-/8_hu10081852515287269042.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<ul>
<li>è®¤è¯†åˆ°ä»£ç çš„å”¯ä¸€ä½œç”¨å°±æ˜¯è¿›è¡Œæ•°æ®è½¬æ¢</li>
<li>è®¤è¯†åˆ°æ•°æ®æ˜¯æ ¸å¿ƒï¼Œè€Œä¸æ˜¯éœ€è¦éšè—èµ·æ¥çš„ä¸œè¥¿</li>
<li>è®¤è¯†åˆ°è®¡ç®—æœºæ›´å–œæ¬¢ç®€å•ã€å¯é¢„æµ‹çš„å·¥ä½œï¼Œå‘è®¡ç®—æœºæä¾›å¤§æ®µè¿ç»­çš„æ•°æ®</li>
<li>è®¤è¯†åˆ°è®¾è®¡æœåŠ¡äºæœºå™¨ï¼Œè€Œéé—®é¢˜çš„å»ºæ¨¡</li>
</ul>
<blockquote>
<p>çš„ç¡®æ¯”è¾ƒæŒ¯è‹å‘è©ï¼Œå°¤å…¶æ˜¯â€œDesign for the machineâ€ï¼Œå®Œå…¨æ˜¯å¯¹ä¹ æƒ¯äºOOPçš„äººçš„ä¸€å¤§å†²å‡»</p>
</blockquote>
<h3 id="5-å¯¹demoçš„ä¼˜åŒ–">5 å¯¹Demoçš„ä¼˜åŒ–</h3>
<h4 id="51-ä¼˜åŒ–1">5.1 ä¼˜åŒ–1</h4>
<ul>
<li>é¿å…å•ç‹¬çš„å†…å­˜è¯·æ±‚ï¼šå¹²æ‰æŒ‡é’ˆ</li>
<li>æ‹‰å¹³æ¶æ„ï¼šå¹²æ‰ç»§æ‰¿</li>
<li>æ•°æ®å’Œé€»è¾‘è§£è€¦ï¼šå®ä½“åªæ˜¯ä¸€äº›æ•°æ®ï¼Œä¸–ç•Œå†³å®šè¡Œä¸º</li>
<li>å°†ä¸åŒçš„ç±»å‹å­˜åœ¨å„è‡ªçš„è¿ç»­çš„æ•°ç»„ä¸­ï¼šä»ä¸€ä¸ªåŸºç±»æŒ‡é’ˆæ•°ç»„åˆ‡æ¢åˆ°è‹¥å¹²å®é™…å¯¹è±¡çš„æ•°ç»„</li>
</ul>
<p>talk is cheapï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">// å½“å‰å‘å°„å™¨å’Œç²’å­éœ€è¦åŒºåˆ†çƒŸé›¾å’Œç«ç„°
</span></span></span><span class="line"><span class="cl"><span class="c1">// *æš‚ä¸”* é€šè¿‡ä¸€ä¸ª `type` å±æ€§æ¥åŒºåˆ†ï¼Œåé¢ä¼šç»§ç»­ä¼˜åŒ–
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">enum</span> <span class="k">class</span> <span class="nc">ParticleType</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">Smoke</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="n">Fire</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Emitter</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">sf</span><span class="o">::</span><span class="n">Vector2f</span> <span class="n">position</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">sf</span><span class="o">::</span><span class="n">Vector2f</span> <span class="n">velocity</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">sf</span><span class="o">::</span><span class="n">Vector2f</span> <span class="n">acceleration</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">spawnTimer</span><span class="p">,</span> <span class="n">spawnRate</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ParticleType</span> <span class="n">type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Particle</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æ•°æ®ä¹‹é—´ä¸å†æœ‰ç»§æ‰¿å…³ç³»ï¼Œå°½ç®¡è¿™æ ·ä¼šå¸¦æ¥ç‰©ç†è¦ç´ çš„é‡å¤ï¼Œä½†æ²¡å¤ªå¤§å…³ç³»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">sf</span><span class="o">::</span><span class="n">Vector2f</span> <span class="n">position</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">sf</span><span class="o">::</span><span class="n">Vector2f</span> <span class="n">velocity</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">sf</span><span class="o">::</span><span class="n">Vector2f</span> <span class="n">acceleration</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">scale</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">opacity</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">rotation</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">scaleRate</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">opacityChange</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">rotationVelocity</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ParticleType</span> <span class="n">type</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Rocket</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">sf</span><span class="o">::</span><span class="n">Vector2f</span> <span class="n">position</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">sf</span><span class="o">::</span><span class="n">Vector2f</span> <span class="n">velocity</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">sf</span><span class="o">::</span><span class="n">Vector2f</span> <span class="n">acceleration</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ç«ç®­ä¸å†é€šè¿‡æŒ‡é’ˆæ¥ç®¡ç†å‘å°„å™¨ï¼Œè€Œæ˜¯é€šè¿‡ç´¢å¼•æ¥å…³è”
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">smokeEmitterIndex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">fireEmitterIndex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>ä¸–ç•Œå¯¹è±¡ç°åœ¨ç®¡ç†æ•°æ®ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">World</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Particle</span><span class="o">&gt;</span> <span class="n">particles</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Rocket</span><span class="o">&gt;</span> <span class="n">rockets</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// è¦ç‚¹ï¼šç”±äºæˆ‘ä»¬çš„rocketé€šè¿‡ç´¢å¼•å…³è”å‘å°„å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// å½“å‘å°„å™¨ç§»é™¤ï¼Œä¸åº”é‡æ’å†…å­˜ï¼Œè€Œåªæ˜¯å°†å¯¹åº”æ§½ä½ç½®ä¸ºæ— æ•ˆï¼Œå› æ­¤è¿™é‡Œä½¿ç”¨optional
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">Emitter</span><span class="o">&gt;&gt;</span> <span class="n">emitters</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">addRocket</span><span class="p">(</span><span class="k">const</span> <span class="n">Rocket</span> <span class="o">&amp;</span><span class="n">rocket</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">addEmitter</span><span class="p">(</span><span class="k">const</span> <span class="n">Emitter</span> <span class="o">&amp;</span><span class="n">emitter</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span><span class="kt">float</span> <span class="n">dt</span><span class="p">)</span><span class="err">ï¼›</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">draw</span><span class="p">(</span><span class="n">sf</span><span class="o">::</span><span class="n">RenderTarget</span> <span class="o">&amp;</span><span class="n">target</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">cleanup</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>ä¸–ç•Œå¯¹è±¡çš„ <code>update</code> æ–¹æ³•ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">World</span><span class="o">::</span><span class="n">update</span><span class="p">(</span><span class="kt">float</span> <span class="n">dt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">Particle</span> <span class="o">&amp;</span><span class="nl">particle</span> <span class="p">:</span> <span class="n">particles</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">particle</span><span class="p">.</span><span class="n">position</span> <span class="o">+=</span> <span class="n">particle</span><span class="p">.</span><span class="n">velocity</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">particle</span><span class="p">.</span><span class="n">velocity</span> <span class="o">+=</span> <span class="n">particle</span><span class="p">.</span><span class="n">acceleration</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">particle</span><span class="p">.</span><span class="n">scale</span> <span class="o">+=</span> <span class="n">particle</span><span class="p">.</span><span class="n">scaleRate</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">particle</span><span class="p">.</span><span class="n">opacity</span> <span class="o">+=</span> <span class="n">particle</span><span class="p">.</span><span class="n">opacityChange</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">particle</span><span class="p">.</span><span class="n">rotation</span> <span class="o">+=</span> <span class="n">particle</span><span class="p">.</span><span class="n">rotationVelocity</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">Emitter</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="nl">e</span> <span class="p">:</span> <span class="n">emitters</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">e</span><span class="p">.</span><span class="n">has_value</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">e</span><span class="o">-&gt;</span><span class="n">position</span> <span class="o">+=</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">velocity</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">e</span><span class="o">-&gt;</span><span class="n">velocity</span> <span class="o">+=</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">acceleration</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">e</span><span class="o">-&gt;</span><span class="n">spawnTimer</span> <span class="o">+=</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">spawnRate</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(;</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">spawnTimer</span> <span class="o">&gt;=</span> <span class="mf">1.f</span><span class="p">;</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">spawnTimer</span> <span class="o">-=</span> <span class="mf">1.f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="p">(</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">==</span> <span class="n">ParticleType</span><span class="o">::</span><span class="n">Smoke</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">particles</span><span class="p">.</span><span class="n">push_back</span><span class="p">({...});</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span> <span class="nf">if</span> <span class="p">(</span><span class="n">e</span><span class="o">-&gt;</span><span class="n">type</span> <span class="o">==</span> <span class="n">ParticleType</span><span class="o">::</span><span class="n">Fire</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">particles</span><span class="p">.</span><span class="n">push_back</span><span class="p">({...});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">Rocket</span> <span class="o">&amp;</span><span class="nl">rocket</span> <span class="p">:</span> <span class="n">rockets</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">rocket</span><span class="p">.</span><span class="n">position</span> <span class="o">+=</span> <span class="n">rocket</span><span class="p">.</span><span class="n">velocity</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">rocket</span><span class="p">.</span><span class="n">velocity</span> <span class="o">+=</span> <span class="n">rocket</span><span class="p">.</span><span class="n">acceleration</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">Emitter</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">se</span> <span class="o">=</span> <span class="n">emitters</span><span class="p">[</span><span class="n">rocket</span><span class="p">.</span><span class="n">smokeEmitterIndex</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="n">se</span><span class="o">-&gt;</span><span class="n">position</span> <span class="o">=</span> <span class="n">rocket</span><span class="p">.</span><span class="n">position</span> <span class="o">-</span> <span class="n">sf</span><span class="o">::</span><span class="n">Vector2f</span><span class="p">(</span><span class="mf">12.f</span><span class="p">,</span> <span class="mf">0.f</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">Emitter</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">fe</span> <span class="o">=</span> <span class="n">emitters</span><span class="p">[</span><span class="n">rocket</span><span class="p">.</span><span class="n">fireEmitterIndex</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">            <span class="n">fe</span><span class="o">-&gt;</span><span class="n">position</span> <span class="o">=</span> <span class="n">rocket</span><span class="p">.</span><span class="n">position</span> <span class="o">-</span> <span class="n">sf</span><span class="o">::</span><span class="n">Vector2f</span><span class="p">(</span><span class="mf">12.f</span><span class="p">,</span> <span class="mf">0.f</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>æ·»åŠ å‘å°„å™¨ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">World</span><span class="o">::</span><span class="n">addEmitter</span><span class="p">(</span><span class="k">const</span> <span class="n">Emitter</span> <span class="o">&amp;</span><span class="n">emitter</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">emitters</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">emitters</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">has_value</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="n">emitters</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">emitter</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">emitters</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">emitter</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">emitters</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>æ¸…ç†ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">World</span><span class="o">::</span><span class="n">cleanup</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æ¸…ç†ç²’å­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">erase_if</span><span class="p">(</span><span class="n">particles</span><span class="p">,</span> <span class="p">[](</span><span class="k">const</span> <span class="n">Particle</span> <span class="o">&amp;</span><span class="n">p</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">p</span><span class="p">.</span><span class="n">opacity</span> <span class="o">&lt;=</span> <span class="mf">0.f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æ¸…ç†ç«ç®­ï¼Œå‘å°„å™¨çš„ç”Ÿå‘½å‘¨æœŸè·Ÿç€ç«ç®­
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">erase_if</span><span class="p">(</span><span class="n">rockets</span><span class="p">,</span> <span class="p">[](</span><span class="k">const</span> <span class="n">Rocket</span> <span class="o">&amp;</span><span class="n">r</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="n">r</span><span class="p">.</span><span class="n">position</span><span class="p">.</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">bounds</span><span class="p">.</span><span class="n">x</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1">// æ¸…ç†å¯¹åº”çš„å‘å°„å™¨
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="n">emitters</span><span class="p">[</span><span class="n">r</span><span class="p">.</span><span class="n">smokeEmitterIndex</span><span class="p">].</span><span class="n">reset</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="n">emitters</span><span class="p">[</span><span class="n">r</span><span class="p">.</span><span class="n">fireEmitterIndex</span><span class="p">].</span><span class="n">reset</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nb">true</span><span class="p">;</span> <span class="c1">// è¶…å‡ºå±å¹•èŒƒå›´
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="p">})</span><span class="err">ï¼›</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>å¯æ€•çš„æ€§èƒ½æå‡ğŸ˜²ğŸ«¡ï¼š</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 179; 
			flex-basis: 430px"
	>
	<a href="/p/cppcon25pratical-data-oriented-design-in-c-/9.png" data-size="1518x847">
		<img src="/p/cppcon25pratical-data-oriented-design-in-c-/9.png"
			width="1518"
			height="847"
			srcset="/p/cppcon25pratical-data-oriented-design-in-c-/9_hu18302114455711385202.png 480w, /p/cppcon25pratical-data-oriented-design-in-c-/9_hu10654747247858193818.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<hr>
<p><strong>æ‰©å±•æ€§</strong></p>
<p>åœ¨æŸäº›æ‰©å±•éœ€æ±‚åœºæ™¯ä¸‹ï¼ŒDoDè¿˜æœ‰æ˜¾è‘—çš„ä¼˜åŠ¿ã€‚</p>
<p>ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬éœ€è¦è·Ÿè¸ªç«ç®­çš„æ•°é‡æ—¶ï¼ŒOOPä¸æ˜¯å¤ªæ…¢ã€å°±æ˜¯ä¼šæ‰“ç ´å„ç§é¢å‘å¯¹è±¡çš„åŸåˆ™ï¼Œè€ŒDoDä¸€è¡Œç§’äº†ï¼š</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 178; 
			flex-basis: 427px"
	>
	<a href="/p/cppcon25pratical-data-oriented-design-in-c-/10.png" data-size="1511x848">
		<img src="/p/cppcon25pratical-data-oriented-design-in-c-/10.png"
			width="1511"
			height="848"
			srcset="/p/cppcon25pratical-data-oriented-design-in-c-/10_hu839920638594494017.png 480w, /p/cppcon25pratical-data-oriented-design-in-c-/10_hu7936819700054189616.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure> <figure 
	
		class="gallery-image" 
		style="
			flex-grow: 180; 
			flex-basis: 432px"
	>
	<a href="/p/cppcon25pratical-data-oriented-design-in-c-/11.png" data-size="1513x840">
		<img src="/p/cppcon25pratical-data-oriented-design-in-c-/11.png"
			width="1513"
			height="840"
			srcset="/p/cppcon25pratical-data-oriented-design-in-c-/11_hu10294139693594287059.png 480w, /p/cppcon25pratical-data-oriented-design-in-c-/11_hu3443738303422378384.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>ä¾‹å¦‚ï¼Œå¯¹å¤šçº¿ç¨‹çš„æ”¯æŒã€‚OOPçš„å®ç°å®é™…ä¸Šå¾ˆéš¾æ”¯æŒå¹¶å‘ï¼Œæ¯•ç«Ÿæ¯ä¸ªå¯¹è±¡éƒ½å¯¹å…¨å±€çš„å¯¹è±¡äº§ç”Ÿå½±å“ï¼Œè€ŒDoDçš„æœ´ç´ å¾ªç¯å¤©ç„¶æ”¯æŒå¹¶å‘æ“ä½œï¼š</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 178; 
			flex-basis: 429px"
	>
	<a href="/p/cppcon25pratical-data-oriented-design-in-c-/14.png" data-size="1520x850">
		<img src="/p/cppcon25pratical-data-oriented-design-in-c-/14.png"
			width="1520"
			height="850"
			srcset="/p/cppcon25pratical-data-oriented-design-in-c-/14_hu12858367930504213327.png 480w, /p/cppcon25pratical-data-oriented-design-in-c-/14_hu13471575707855015029.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure> <figure 
	
		class="gallery-image" 
		style="
			flex-grow: 178; 
			flex-basis: 429px"
	>
	<a href="/p/cppcon25pratical-data-oriented-design-in-c-/15.png" data-size="1516x847">
		<img src="/p/cppcon25pratical-data-oriented-design-in-c-/15.png"
			width="1516"
			height="847"
			srcset="/p/cppcon25pratical-data-oriented-design-in-c-/15_hu958766615921814844.png 480w, /p/cppcon25pratical-data-oriented-design-in-c-/15_hu16196223889278836658.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<p><strong>å¯è¯»æ€§</strong></p>
<p>è‡³äºä»£ç çš„å¯è¯»æ€§ï¼ŒDoDçš„ä»£ç æ¯”OOPæ›´ç›´ç™½ï¼Œæ›´æ¾è€¦åˆï¼Œæ›´æ˜“ç»´æŠ¤ã€‚</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 179; 
			flex-basis: 430px"
	>
	<a href="/p/cppcon25pratical-data-oriented-design-in-c-/12.png" data-size="1516x845">
		<img src="/p/cppcon25pratical-data-oriented-design-in-c-/12.png"
			width="1516"
			height="845"
			srcset="/p/cppcon25pratical-data-oriented-design-in-c-/12_hu10419330792162832265.png 480w, /p/cppcon25pratical-data-oriented-design-in-c-/12_hu17981198533867461022.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure> <figure 
	
		class="gallery-image" 
		style="
			flex-grow: 179; 
			flex-basis: 429px"
	>
	<a href="/p/cppcon25pratical-data-oriented-design-in-c-/13.png" data-size="1522x850">
		<img src="/p/cppcon25pratical-data-oriented-design-in-c-/13.png"
			width="1522"
			height="850"
			srcset="/p/cppcon25pratical-data-oriented-design-in-c-/13_hu11801942938935829101.png 480w, /p/cppcon25pratical-data-oriented-design-in-c-/13_hu17883041461787745195.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<blockquote>
<p>âœ”ï¸æ„Ÿæ‚Ÿï¼šåœ¨å·¥ä½œä¸­çš„ç¡®å‘ç°OOPçš„ä»£ç åœ¨å¤æ‚çš„ç»§æ‰¿å…³ç³»å‡ºç°æ—¶ä¼šå˜æˆä¸€å¨ã€‚æ¥è§¦æ–°åŠŸèƒ½æ¨¡å—æ—¶ç‚¹å‡ºä¸€ä¸ªæŠ½è±¡ç±»çš„æ‰€æœ‰å­ç±»ä¸€ä¸ªä¸ªçœ‹è¿‡å»ï¼Œè¿˜è¦åœ¨ä¸€è¾¹æ—¶åˆ»è®°ç€è°ƒç”¨ç‚¹çš„ä¸Šä¸‹æ–‡ï¼Œä¸çŸ¥é“å¸¦èµ°äº†æˆ‘å¤šå°‘ä¸ªè„‘ç»†èƒâ€¦ ğŸ˜¶â€ğŸŒ«ï¸</p>
</blockquote>
<h4 id="52-ä¼˜åŒ–2">5.2 ä¼˜åŒ–2</h4>
<ul>
<li>åœ¨é«˜é¢‘å¾ªç¯ä¸­é¿å…åˆ†æ”¯ï¼Œä»¥å…ç¼“å­˜å‘½ä¸­ç‡ä¸‹é™</li>
<li>å‡å°å…¬å…±ç±»å‹çš„ä½“ç§¯ï¼Œä½¿å¾—ç¼“å­˜å¯ä»¥å¡ä¸‹æ›´å¤šçš„å¯¹è±¡</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">// ã€5.2ã€‘ç›¸æ¯”äº5.1ï¼Œä¸å†éœ€è¦å‘å°„å™¨/ç²’å­ç±»å‹ï¼Œå°†ç”±ä¸–ç•Œå¯¹è±¡æ¥åˆ†ç±»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">struct</span> <span class="nc">Emitter</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">sf</span><span class="o">::</span><span class="n">Vector2f</span> <span class="n">position</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">sf</span><span class="o">::</span><span class="n">Vector2f</span> <span class="n">velocity</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">sf</span><span class="o">::</span><span class="n">Vector2f</span> <span class="n">acceleration</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">spawnTimer</span><span class="p">,</span> <span class="n">spawnRate</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Particle</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// æ•°æ®ä¹‹é—´ä¸å†æœ‰ç»§æ‰¿å…³ç³»ï¼Œå°½ç®¡è¿™æ ·ä¼šå¸¦æ¥å­—æ®µçš„é‡å¤ï¼Œä½†æ²¡å¤ªå¤§å…³ç³»
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">sf</span><span class="o">::</span><span class="n">Vector2f</span> <span class="n">position</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">sf</span><span class="o">::</span><span class="n">Vector2f</span> <span class="n">velocity</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">sf</span><span class="o">::</span><span class="n">Vector2f</span> <span class="n">acceleration</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">scale</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">opacity</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">rotation</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">scaleRate</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">opacityChange</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="kt">float</span> <span class="n">rotationVelocity</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">Rocket</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">sf</span><span class="o">::</span><span class="n">Vector2f</span> <span class="n">position</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">sf</span><span class="o">::</span><span class="n">Vector2f</span> <span class="n">velocity</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">sf</span><span class="o">::</span><span class="n">Vector2f</span> <span class="n">acceleration</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ã€5.2ã€‘ä½œè€…æŒ‡å‡º5.1çš„ size_t å ç”¨çš„å¤§å°å¤ªå¤§ï¼ˆ64æ¯”ç‰¹ï¼‰ï¼Œå®é™…åªéœ€è¦ u16
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// è¯´å®è¯ï¼Œæˆ‘æ„Ÿè§‰65536ä¸ªå‘å°„å™¨å¥½åƒä¸æ»¡è¶³benchmarkä¸Šç™¾ä¸‡ä¸ªç«ç®­çš„éœ€è¦ï¼Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="c1">// å¯èƒ½æ˜¯å› ä¸ºä¸€ä¸ªå±æ²¡åŠæ³•åŒæ—¶å­˜åœ¨è¿™ä¹ˆå¤šæ•°æ®ï¼Œå†…å­˜æ˜¯å¾ªç¯åˆ©ç”¨çš„ï¼Œæ‰èƒ½åšè¿™ç§æ”¹é€ ï¼Ÿ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="kt">uint16_t</span> <span class="n">smokeEmitterIndex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="kt">uint16_t</span> <span class="n">fireEmitterIndex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>ç”±äºæˆ‘ä»¬ä¸å†è¿›è¡Œå‘å°„å™¨/ç²’å­çš„åˆ†ç±»ï¼Œä¸–ç•Œå¯¹è±¡çš„æ•°æ®ç®¡ç†ä¼šå˜å¾—ç²¾ç»†ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">World</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ã€5.2ã€‘ç›¸æ¯”äº5.1ï¼Œè¿™é‡Œå¯¹æ•°ç»„çš„ç®¡ç†æ›´ç»†
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Particle</span><span class="o">&gt;</span> <span class="n">smokeParticles</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Particle</span><span class="o">&gt;</span> <span class="n">fireParticles</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Rocket</span><span class="o">&gt;</span> <span class="n">rockets</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">Emitter</span><span class="o">&gt;&gt;</span> <span class="n">smokeEmitters</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">Emitter</span><span class="o">&gt;&gt;</span> <span class="n">fireEmitters</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">addRocket</span><span class="p">(</span><span class="k">const</span> <span class="n">Rocket</span> <span class="o">&amp;</span><span class="n">rocket</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// // ã€5.2ã€‘ç›¸æ¯”äº5.1ï¼Œè¿™é‡Œæ”¯æŒæŒ‡å®šè¦æ·»åŠ çš„æ•°ç»„
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">addEmitter</span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;</span> <span class="n">targetVec</span><span class="p">,</span> <span class="k">const</span> <span class="n">Emitter</span> <span class="o">&amp;</span><span class="n">emitter</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">update</span><span class="p">(</span><span class="kt">float</span> <span class="n">dt</span><span class="p">)</span><span class="err">ï¼›</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="n">draw</span><span class="p">(</span><span class="n">sf</span><span class="o">::</span><span class="n">RenderTarget</span> <span class="o">&amp;</span><span class="n">target</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">cleanup</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><p>ä¼˜åŒ–åçš„æ›´æ–°å‡½æ•°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">World</span><span class="o">::</span><span class="n">update</span><span class="p">(</span><span class="kt">float</span> <span class="n">dt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="n">updateParticles</span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="n">Particle</span><span class="o">&amp;</span> <span class="n">particles</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">particle</span><span class="p">.</span><span class="n">position</span> <span class="o">+=</span> <span class="n">particle</span><span class="p">.</span><span class="n">velocity</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">particle</span><span class="p">.</span><span class="n">velocity</span> <span class="o">+=</span> <span class="n">particle</span><span class="p">.</span><span class="n">acceleration</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">particle</span><span class="p">.</span><span class="n">scale</span> <span class="o">+=</span> <span class="n">particle</span><span class="p">.</span><span class="n">scaleRate</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">particle</span><span class="p">.</span><span class="n">opacity</span> <span class="o">+=</span> <span class="n">particle</span><span class="p">.</span><span class="n">opacityChange</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">particle</span><span class="p">.</span><span class="n">rotation</span> <span class="o">+=</span> <span class="n">particle</span><span class="p">.</span><span class="n">rotationVelocity</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">Particle</span> <span class="o">&amp;</span><span class="nl">particle</span> <span class="p">:</span> <span class="n">smokeParticles</span><span class="p">)</span> <span class="n">updateParticles</span><span class="p">(</span><span class="n">particle</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">Particle</span> <span class="o">&amp;</span><span class="nl">particle</span> <span class="p">:</span> <span class="n">fireParticles</span><span class="p">)</span> <span class="n">updateParticles</span><span class="p">(</span><span class="n">particle</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="n">updateEmitter</span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">Emitter</span><span class="o">&gt;&amp;</span> <span class="n">e</span><span class="p">,</span> <span class="k">auto</span><span class="o">&amp;&amp;</span> <span class="n">fSpawn</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">e</span><span class="p">.</span><span class="n">has_value</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">            <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">e</span><span class="o">-&gt;</span><span class="n">position</span> <span class="o">+=</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">velocity</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">e</span><span class="o">-&gt;</span><span class="n">velocity</span> <span class="o">+=</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">acceleration</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">e</span><span class="o">-&gt;</span><span class="n">spawnTimer</span> <span class="o">+=</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">spawnRate</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(;</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">spawnTimer</span> <span class="o">&gt;=</span> <span class="mf">1.f</span><span class="p">;</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">spawnTimer</span> <span class="o">-=</span> <span class="mf">1.f</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="n">fSpawn</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">Emitter</span><span class="o">&gt;&amp;</span> <span class="nl">e</span> <span class="p">:</span> <span class="n">smokeEmitters</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">updateEmitter</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">]</span> <span class="p">{</span> <span class="n">smokeParticles</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(...);</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">Emitter</span><span class="o">&gt;&amp;</span> <span class="nl">e</span> <span class="p">:</span> <span class="n">fireEmitters</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">updateEmitter</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">]</span> <span class="p">{</span> <span class="n">fireParticles</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(...);</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>æ€§èƒ½æå‡å¹¶ä¸å¾ˆå¤§ï¼ŒåŸå› æ˜¯å¯¹äºä½œè€…çš„benchmarkæµ‹è¯•æ¥è¯´ï¼Œæ€§èƒ½ç“¶é¢ˆå·²ç»ä¸åœ¨äºæ•°æ®çš„å®‰æ’ï¼Œè€Œåœ¨äºæ›´æ–°particleã€‚ä½œè€…è‡ªé™ˆï¼Œä¼˜åŒ–åçš„æ•°æ®ç»“æ„åœ¨æ¸²æŸ“æ—¶å¸¦æ¥äº†12%çš„æ€§èƒ½æå‡ã€‚</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 178; 
			flex-basis: 428px"
	>
	<a href="/p/cppcon25pratical-data-oriented-design-in-c-/16.png" data-size="1518x850">
		<img src="/p/cppcon25pratical-data-oriented-design-in-c-/16.png"
			width="1518"
			height="850"
			srcset="/p/cppcon25pratical-data-oriented-design-in-c-/16_hu18069446886534235613.png 480w, /p/cppcon25pratical-data-oriented-design-in-c-/16_hu233018878266016890.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<h4 id="53-ä¼˜åŒ–3">5.3 ä¼˜åŒ–3</h4>
<ul>
<li>ä» <em>Array of Structs</em> ï¼ˆå¯¹è±¡æ•°ç»„ï¼‰æ”¹æˆ <em>Struct of Arrays</em> ï¼ˆæ•°ç»„å¯¹è±¡ï¼‰</li>
</ul>
<p>ä¸æ•²ä»£ç äº†ï¼š</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 179; 
			flex-basis: 431px"
	>
	<a href="/p/cppcon25pratical-data-oriented-design-in-c-/17.png" data-size="1511x841">
		<img src="/p/cppcon25pratical-data-oriented-design-in-c-/17.png"
			width="1511"
			height="841"
			srcset="/p/cppcon25pratical-data-oriented-design-in-c-/17_hu2444119559110335323.png 480w, /p/cppcon25pratical-data-oriented-design-in-c-/17_hu6560399056473588303.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>ç›¸æ¯”äºAoSï¼ŒSoAå­˜åœ¨å¦‚ä¸‹æ–¹é¢çš„æå‡ï¼š</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 178; 
			flex-basis: 429px"
	>
	<a href="/p/cppcon25pratical-data-oriented-design-in-c-/18.png" data-size="1513x846">
		<img src="/p/cppcon25pratical-data-oriented-design-in-c-/18.png"
			width="1513"
			height="846"
			srcset="/p/cppcon25pratical-data-oriented-design-in-c-/18_hu17402534095562776053.png 480w, /p/cppcon25pratical-data-oriented-design-in-c-/18_hu15862703896513886581.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<ul>
<li>æ²¡æœ‰å¯¹è±¡å†…éƒ¨çš„ <em>padding</em> ã€‚æˆ‘ä»¬çŸ¥é“ä¸€ä¸ªæ•°æ®ç»“æ„å†…éƒ¨çš„å­—æ®µä¸ç­‰é•¿ï¼Œå› æ­¤AoSå•å…ƒä¹‹é—´ä¼šç”±äºæ¯ä¸ªå¯¹è±¡å†…éƒ¨çš„å¯¹é½ï¼Œå­˜åœ¨ä¸€äº›ç©ºå†…å­˜</li>
<li>æ›´çµæ´»çš„å­—æ®µåŠ è½½ã€‚å½“æˆ‘ä»¬åªéœ€è¦è®¿é—®ä¸€ä¸ªå¯¹è±¡çš„ä¸€ä¸ªå­—æ®µæ—¶ï¼ŒAoSä¼šéœ€è¦é€ä¸ªåŠ è½½æ•´ä¸ªå¯¹è±¡ï¼Œè€ŒSoAèƒ½å¤Ÿæ‰¹é‡åŠ è½½æ‰€æœ‰å¯¹è±¡çš„è¿™ä¸ªå­—æ®µï¼Œä¸éœ€è¦åŠ è½½å…¶ä½™æ— å…³å­—æ®µã€‚ï¼ˆæ³¨ã€æˆ‘çš„ç†è§£ï¼Œè¿™å®é™…ä¸Šéœ€è¦å’Œæ•°æ®å¤„ç†é€»è¾‘éƒ¨åˆ†æ·±åº¦è”ç³»ï¼Œå³ï¼Œå¯èƒ½éœ€è¦å®ç°å­—æ®µçº§åˆ«çš„æ‰¹å¤„ç†æ—¶ï¼Œè¿™ç§ç‰¹æ€§çš„ä¼˜åŠ¿ä¼šæ¯”è¾ƒæ˜æ˜¾ï¼Œåä¹‹åˆ™æ˜¯åŠ£åŠ¿ï¼‰</li>
<li>æ›´å¥½åœ°æ”¯æŒå‘é‡åŒ–æ“ä½œã€‚è¿™é‡Œä¸»è¦ä¹Ÿæ˜¯æŒ‡ä¾¿äºè¿›è¡Œå­—æ®µçº§åˆ«çš„æ‰¹å¤„ç†ï¼Œåœ¨è¿™ç§åº”ç”¨åœºæ™¯ä¸‹SIMDï¼ˆå•æŒ‡ä»¤å¤šæ•°æ®ï¼‰ä¼šè¿›ä¸€æ­¥å¸¦æ¥æ€§èƒ½æå‡</li>
</ul>
<blockquote>
<p>æ‹“å±•é˜…è¯»ï¼š</p>
<p>[1] ç†è§£SIMDæŠ€æœ¯ï¼Œé«˜æ•ˆå¹¶è¡Œè®¡ç®—çš„åˆ©å™¨,https://blog.csdn.net/qq_34068440/article/details/139636268</p>
</blockquote>
<p>æ”¹é€ ä¸ºSoAçš„å®ç°å¦‚ä¸‹ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">ParticleSoA</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">sf</span><span class="o">::</span><span class="n">Vector2f</span><span class="o">&gt;</span> <span class="n">positions</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">sf</span><span class="o">::</span><span class="n">Vector2f</span><span class="o">&gt;</span> <span class="n">velocitys</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">sf</span><span class="o">::</span><span class="n">Vector2f</span><span class="o">&gt;</span> <span class="n">accelerations</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">scales</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">opacities</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">rotations</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">scaleRates</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">opacityChanges</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">rotationVelocities</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="kt">void</span> <span class="nf">forAllVectors</span><span class="p">(</span><span class="k">auto</span><span class="o">&amp;&amp;</span> <span class="n">f</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span><span class="p">(</span><span class="n">positions</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span><span class="p">(</span><span class="n">velocitys</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span><span class="p">(</span><span class="n">accelerations</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span><span class="p">(</span><span class="n">scales</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span><span class="p">(</span><span class="n">opacities</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span><span class="p">(</span><span class="n">rotations</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span><span class="p">(</span><span class="n">scaleRates</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span><span class="p">(</span><span class="n">opacityChanges</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="n">f</span><span class="p">(</span><span class="n">rotationVelocities</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">struct</span> <span class="nc">World</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ã€5.3ã€‘ç›¸æ¯”äº5.2ï¼Œè¿™é‡Œç²’å­ç±»å‹ä½¿ç”¨äº†SoA
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">ParticleSoA</span> <span class="n">smokeParticles</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">ParticleSoA</span> <span class="n">fireParticles</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ã€5.3ã€‘è¿™é‡Œä¸åšæ”¹é€ çš„åŸå› æ˜¯æ€§èƒ½ç“¶é¢ˆä¸åœ¨è¿™é‡Œ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Rocket</span><span class="o">&gt;</span> <span class="n">rockets</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">Emitter</span><span class="o">&gt;&gt;</span> <span class="n">smokeEmitters</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">Emitter</span><span class="o">&gt;&gt;</span> <span class="n">fireEmitters</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span></code></pre></div><p>æ”¹é€ åçš„æ›´æ–°å‡½æ•°ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">World</span><span class="o">::</span><span class="n">update</span><span class="p">(</span><span class="kt">float</span> <span class="n">dt</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ã€5.3ã€‘ç›¸æ¯”äº5.2ï¼Œè¿™é‡Œä½¿ç”¨äº†SoA
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">auto</span> <span class="n">updateParticles</span> <span class="o">=</span> <span class="p">[</span><span class="o">&amp;</span><span class="p">](</span><span class="n">ParticleSoA</span><span class="o">&amp;</span> <span class="n">soa</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">const</span> <span class="k">auto</span> <span class="n">nParticles</span> <span class="o">=</span> <span class="n">soa</span><span class="p">.</span><span class="n">positions</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// è¿­ä»£é‡Œé¢çš„æ“ä½œæ˜¯æ··åˆçš„ï¼Œä¸»è¦æ˜¯Vittorioåšçš„å®éªŒå‘ç°è¿™é‡Œæ··åˆè¿­ä»£æ€§èƒ½è¾ƒå¥½
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nParticles</span><span class="p">;</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">            <span class="n">soa</span><span class="p">.</span><span class="n">velocitys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">soa</span><span class="p">.</span><span class="n">accelerations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">soa</span><span class="p">.</span><span class="n">positions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">soa</span><span class="p">.</span><span class="n">velocitys</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">soa</span><span class="p">.</span><span class="n">scales</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">soa</span><span class="p">.</span><span class="n">scaleRates</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">soa</span><span class="p">.</span><span class="n">opacities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">soa</span><span class="p">.</span><span class="n">opacityChanges</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="n">soa</span><span class="p">.</span><span class="n">rotations</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+=</span> <span class="n">soa</span><span class="p">.</span><span class="n">rotationVelocities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="n">updateParticles</span><span class="p">(</span><span class="n">smokeParticles</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">updateParticles</span><span class="p">(</span><span class="n">fireParticles</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">optional</span><span class="o">&lt;</span><span class="n">Emitter</span><span class="o">&gt;&amp;</span> <span class="nl">e</span> <span class="p">:</span> <span class="n">smokeEmitters</span><span class="p">)</span> <span class="p">{</span> 
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">e</span><span class="p">.</span><span class="n">has_value</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">e</span><span class="o">-&gt;</span><span class="n">position</span> <span class="o">+=</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">velocity</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">e</span><span class="o">-&gt;</span><span class="n">velocity</span> <span class="o">+=</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">acceleration</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">e</span><span class="o">-&gt;</span><span class="n">spawnTimer</span> <span class="o">+=</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">spawnRate</span> <span class="o">*</span> <span class="n">dt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="p">(;</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">spawnTimer</span> <span class="o">&gt;=</span> <span class="mf">1.f</span><span class="p">;</span> <span class="n">e</span><span class="o">-&gt;</span><span class="n">spawnTimer</span> <span class="o">-=</span> <span class="mf">1.f</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// ã€5.3ã€‘è¿™é‡Œä¸å¾—ä¸åˆ†åˆ«å¯¹æ¯ä¸ªå­—æ®µå•ç‹¬æ·»åŠ ï¼Œæ¯”è¾ƒæ¶å¿ƒä½†æ²¡åŠæ³• ğŸ«¥
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// ä¹Ÿè®¸SoAå¯¹è±¡è‡ªè¡Œå°è£…ä¸€ä¸ªemplaceå‡½æ•°ï¼Œæ¥å®Œæˆè¿™ä¸ªæ“ä½œä¼šæ›´å¥½ï¼Œä¸é‡è¦~
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">smokeParticles</span><span class="p">.</span><span class="n">positions</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(...);</span>
</span></span><span class="line"><span class="cl">            <span class="n">smokeParticles</span><span class="p">.</span><span class="n">velocitys</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(...);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">smokeParticles</span><span class="p">.</span><span class="n">rotationVelocities</span><span class="p">.</span><span class="n">emplace_back</span><span class="p">(...);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>æ¸…ç†å‡½æ•°ä¹Ÿæ˜¯å¸¦æœ‰SoAé£æ ¼çš„ï¼š</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">// é¦–å…ˆå®šä¹‰ä¸€ä¸ªç®€å•çš„å¸®åŠ©æ–¹æ³•
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">soaEraseIf</span><span class="p">(</span><span class="n">ParticleSoA</span><span class="o">&amp;</span> <span class="n">soa</span><span class="p">,</span> <span class="k">auto</span><span class="o">&amp;&amp;</span> <span class="n">predicate</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">n</span> <span class="o">=</span> <span class="n">soa</span><span class="p">.</span><span class="n">positions</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0u</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">while</span> <span class="p">(</span><span class="n">i</span> <span class="o">&lt;</span> <span class="n">n</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">predicate</span><span class="p">(</span><span class="n">soa</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="o">++</span><span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">            <span class="k">continue</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// ğŸ”–è¿™é‡Œå¾ˆå¦™ï¼Œéœ€ç»†å“
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="o">--</span><span class="n">n</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="n">soa</span><span class="p">.</span><span class="n">forAllVectors</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](</span><span class="k">auto</span><span class="o">&amp;</span> <span class="n">vec</span><span class="p">)</span> <span class="p">{</span> <span class="n">vec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">vec</span><span class="p">[</span><span class="n">n</span><span class="p">];</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="n">soa</span><span class="p">.</span><span class="n">forAllVectors</span><span class="p">([</span><span class="o">&amp;</span><span class="p">](</span><span class="k">auto</span><span class="o">&amp;</span> <span class="n">vec</span><span class="p">)</span> <span class="p">{</span> <span class="n">vec</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">n</span><span class="p">);</span> <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="n">World</span><span class="o">::</span><span class="n">cleanup</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">auto</span> <span class="n">hasNegativeOpacity</span> <span class="o">=</span> <span class="p">[](</span><span class="k">const</span> <span class="n">ParticleSoA</span><span class="o">&amp;</span> <span class="n">soa</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">size_t</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">soa</span><span class="p">.</span><span class="n">opacities</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mf">0.f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="n">soaEraseIf</span><span class="p">(</span><span class="n">smokeParticles</span><span class="p">,</span> <span class="n">hasNegativeOpacity</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">soaEraseIf</span><span class="p">(</span><span class="n">fireParticles</span><span class="p">,</span> <span class="n">hasNegativeOpacity</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">}</span>
</span></span></code></pre></div><p>æ”¶ç›Šä¹Ÿæ˜¯éå¸¸çš„amazingï¼š</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 178; 
			flex-basis: 429px"
	>
	<a href="/p/cppcon25pratical-data-oriented-design-in-c-/19.png" data-size="1516x847">
		<img src="/p/cppcon25pratical-data-oriented-design-in-c-/19.png"
			width="1516"
			height="847"
			srcset="/p/cppcon25pratical-data-oriented-design-in-c-/19_hu2484940084883594255.png 480w, /p/cppcon25pratical-data-oriented-design-in-c-/19_hu10252215922456562818.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>å¯¹äºSoAåˆ†ä¸ºå¤šä¸ªæ•°ç»„å­—æ®µæ‰€å¸¦æ¥çš„ä¸æ˜“ç»´æŠ¤é—®é¢˜ï¼ŒVittorioæä¾›äº†ä¸€äº›åå°„å®ç°ï¼š</p>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 178; 
			flex-basis: 429px"
	>
	<a href="/p/cppcon25pratical-data-oriented-design-in-c-/20.png" data-size="1512x845">
		<img src="/p/cppcon25pratical-data-oriented-design-in-c-/20.png"
			width="1512"
			height="845"
			srcset="/p/cppcon25pratical-data-oriented-design-in-c-/20_hu4569994164053250784.png 480w, /p/cppcon25pratical-data-oriented-design-in-c-/20_hu12051097503537907757.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<p>å¹¶æåŠè¿™äº›å®ç°å°†åœ¨C++26æœ‰çœŸæ­£çš„å®˜æ–¹æ”¯æŒ~ğŸ˜²</p>
<h4 id="54-one-more-thing">5.4 one more thing</h4>
<ul>
<li>DoDå’ŒSoAå¹¶æ²¡æœ‰ç›´æ¥è”ç³»ï¼ŒSoAåªæ˜¯ä¸€ç§ä¼˜åŒ–ç­–ç•¥è€Œéç»ˆæç­”æ¡ˆ</li>
</ul>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 187; 
			flex-basis: 450px"
	>
	<a href="/p/cppcon25pratical-data-oriented-design-in-c-/21.png" data-size="1477x787">
		<img src="/p/cppcon25pratical-data-oriented-design-in-c-/21.png"
			width="1477"
			height="787"
			srcset="/p/cppcon25pratical-data-oriented-design-in-c-/21_hu8230816338949601031.png 480w, /p/cppcon25pratical-data-oriented-design-in-c-/21_hu9981513575824479441.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<ul>
<li>DoDä¹Ÿå¹¶éç»ˆæç­”æ¡ˆï¼ŒOOPåœ¨æ›´ä¸Šå±‚çš„ä¸šåŠ¡ä¸­ä»èµ·åˆ°ä¼˜ç§€çš„æŠ½è±¡ä½œç”¨ï¼ˆæ³¨ã€OOPæ˜¯å¤–å£³ï¼ŒDoDæ˜¯å¼•æ“ï¼Œè¿™å¥è¯ä¸ªäººè§‰å¾—éå¸¸å¥½åœ°æè¿°äº†ä¸¤è€…çš„åˆé€‚çš„å…³ç³»ï¼‰</li>
</ul>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 182; 
			flex-basis: 436px"
	>
	<a href="/p/cppcon25pratical-data-oriented-design-in-c-/22.png" data-size="1504x826">
		<img src="/p/cppcon25pratical-data-oriented-design-in-c-/22.png"
			width="1504"
			height="826"
			srcset="/p/cppcon25pratical-data-oriented-design-in-c-/22_hu6524415594779468322.png 480w, /p/cppcon25pratical-data-oriented-design-in-c-/22_hu5508765578805549557.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<h3 id="6-æ€»ç»“">6 æ€»ç»“</h3>
<ul>
<li>è€ƒé‡æ€§èƒ½äºæœ€åˆ</li>
<li>æ‰å¹³ã€ç²¾ç®€çš„æ•°æ®ç»“æ„</li>
<li>å¦¥å½“çš„åˆ†ç±»è€Œéå„ç§ç±»å‹æ ‡è¯†</li>
<li>åœ¨éœ€è¦æ‰¹å¤„ç†æ—¶è€ƒè™‘SoA</li>
</ul>
<p><figure 
	
		class="gallery-image" 
		style="
			flex-grow: 182; 
			flex-basis: 438px"
	>
	<a href="/p/cppcon25pratical-data-oriented-design-in-c-/23.png" data-size="1506x825">
		<img src="/p/cppcon25pratical-data-oriented-design-in-c-/23.png"
			width="1506"
			height="825"
			srcset="/p/cppcon25pratical-data-oriented-design-in-c-/23_hu11643206164514503739.png 480w, /p/cppcon25pratical-data-oriented-design-in-c-/23_hu11282351607161604186.png 1024w"
			loading="lazy"
			>
	</a>
	
</figure></p>
<p><em>Data drives design</em></p>
<ul>
<li>æ•°æ®æ˜¯è®¾è®¡çš„æ ¸å¿ƒé©±åŠ¨åŠ›ã€‚è¿™æ„å‘³ç€åœ¨è¿›è¡Œç³»ç»Ÿæˆ–ä»£ç è®¾è®¡æ—¶ï¼Œåº”ä»¥å®é™…çš„æ•°æ®ç»“æ„ã€æ•°æ®æµå’Œä½¿ç”¨åœºæ™¯ä¸ºä¾æ®ï¼Œè€Œä¸æ˜¯å‡­ç©ºæƒ³è±¡æˆ–éµå¾ªå›ºå®šæ¨¡å¼ã€‚</li>
</ul>
<p><em>Target the machine</em></p>
<ul>
<li>ç¼–ç¨‹çš„ç›®æ ‡æ˜¯è®©æœºå™¨é«˜æ•ˆè¿è¡Œã€‚å¼ºè°ƒè¦å…³æ³¨åº•å±‚ç¡¬ä»¶å’Œæ‰§è¡Œæ•ˆç‡ï¼Œç¼–å†™èƒ½å¤Ÿè¢«æœºå™¨é«˜æ•ˆæ‰§è¡Œçš„ä»£ç ï¼Œé¿å…è¿‡åº¦æŠ½è±¡æˆ–ä¸å¿…è¦çš„å¼€é”€ã€‚</li>
</ul>
<p><em>Itâ€™s a spectrum, not dogma</em></p>
<ul>
<li>è½¯ä»¶å¼€å‘ä¸­çš„å„ç§æ–¹æ³•å’ŒæŠ€æœ¯æ˜¯ä¸€ä¸ªè¿ç»­è°±ç³»ï¼Œè€Œééé»‘å³ç™½çš„æ•™æ¡ã€‚é¼“åŠ±çµæ´»é€‰æ‹©é€‚åˆå½“å‰åœºæ™¯çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œä¸ç›²ç›®è¿½éšæŸç§â€œæœ€ä½³å®è·µâ€ã€‚</li>
</ul>
<p><em>Embrace Modern C++</em></p>
<ul>
<li>ç§¯æé‡‡ç”¨ç°ä»£C++ï¼ˆå¦‚C++11åŠä»¥ä¸Šç‰ˆæœ¬ï¼‰çš„æ–°ç‰¹æ€§ï¼Œä¾‹å¦‚æ™ºèƒ½æŒ‡é’ˆã€lambdaè¡¨è¾¾å¼ã€èŒƒå›´forå¾ªç¯ç­‰ï¼Œä»¥æå‡ä»£ç çš„å®‰å…¨æ€§ã€å¯è¯»æ€§å’Œæ€§èƒ½ã€‚</li>
</ul>
<p><em>Pragmatism wins</em></p>
<ul>
<li>å®ç”¨ä¸»ä¹‰èƒœå‡ºã€‚æœ€ç»ˆå†³å®šå› ç´ æ˜¯å®é™…æ•ˆæœï¼šæ˜¯å¦è§£å†³äº†é—®é¢˜ã€æ˜¯å¦æ˜“äºç»´æŠ¤ã€æ˜¯å¦é«˜æ•ˆç¨³å®šã€‚ä¸è¦ä¸ºäº†è¿½æ±‚â€œä¼˜é›…â€è€Œç‰ºç‰²å®ç”¨æ€§ã€‚</li>
</ul>
<h3 id="7-qa">7 Q&amp;A</h3>
<blockquote>
<p>Q&amp;Aç¯èŠ‚ï¼Œä¸€äº›é—®é¢˜ä¹Ÿé¢‡æœ‰å¯å‘ï¼Œæµ…åšè®°å½•ï¼ˆè®°å½•æˆ‘ç†è§£åˆ°çš„æ„æ€è€Œéå¿ å®åœ°ç¿»è¯‘é—®ç­”å¯¹è¯ï¼‰ã€‚</p>
</blockquote>
<p>Q:æˆ‘è®¤ä¸ºä¸€äº›ä¹ äºé¢å‘å¯¹è±¡çš„ç¨‹åºå‘˜ä¼šè®¤ä¸ºDoDä¸¢å¤±äº†ä¸€äº›å¯¹è±¡é—´çš„è”ç³»ï¼Œä¾‹å¦‚åœ¨OOPä¸­ <code>Rocket</code> å’Œ <code>Emitter</code> æœ‰ç€æ¸…æ™°çš„è”ç³»ï¼Œè€ŒDoDä¸­è¿™ç§è”ç³»ä¼¼ä¹ä¸¢å¤±äº†ã€‚å¯¹æ­¤ä½ æ€ä¹ˆçœ‹ï¼Ÿ</p>
<p>A:ä»…ä»…è§‚å¯Ÿæ•°æ®æœ¬èº«çš„è¯ï¼Œæˆ‘èƒ½getåˆ°è¿™ä¸ªé—®é¢˜ç‚¹ã€‚æˆ‘æƒ³æŒ‡å‡ºè™½ç„¶æˆ‘ä»¬åœ¨ç¤ºä¾‹ä¸­ä½¿ç”¨æ•´å‹ç´¢å¼•è¿›è¡Œå…³è”æ€§çš„è¡¨è¾¾ï¼Œä½†å®é™…ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€äº› <code>handle</code> æˆ–å¼ºç±»å‹å®šä¹‰æ¥ä½¿å¾—å…³è”æ€§çš„è¡¨è¾¾æ›´æ¸…æ™°ã€‚å¦ä¸€æ–¹é¢ï¼Œæˆ‘è§‰å¾—å½“æˆ‘ä»¬æ“ä½œæ•°æ®æ—¶ï¼Œè¿™ç§è”ç³»å®é™…ä¸Šæ˜¯å˜æ¸…æ™°è€Œéå‡å¼±ï¼Œå½“æˆ‘ä»¬é˜…è¯» <code>update</code> ä¸­çš„å¾ªç¯æ—¶ï¼Œæˆ‘ä»¬ä¸æ­¢çŸ¥é“ <code>Emitter</code> å’Œ <code>Rocket</code> ä¹‹é—´å­˜åœ¨è”ç³»ï¼Œè¿˜çŸ¥é“è¿™ç§è”ç³»æ˜¯ä¸ºäº†ä»€ä¹ˆã€äº§ç”Ÿäº†ä»€ä¹ˆä½œç”¨ã€‚å› æ­¤ï¼Œåœ¨è¿™ç§è§†è§’ä¸‹æˆ‘ä»¬å¾—å¤§äºå¤±ã€‚</p>
<hr>
<p>Q:ä½ å¦‚ä½•æ¯”è¾ƒDoDå’ŒOOPäºŒè€…ä¹‹é—´çš„å¯æµ‹è¯•æ€§ï¼ˆ <em>testability</em> ï¼‰ï¼Ÿ</p>
<p>A:æˆ‘è®¤ä¸ºDoDï¼ˆç»™å¯æµ‹è¯•æ€§ï¼‰å¸¦æ¥äº†ä¸€äº›å¾ˆå¥½çš„æ”¶ç›Šï¼Œä¾‹å¦‚ç”±äºæˆ‘ä»¬çš„ä¸€åˆ‡éƒ½åªæ˜¯æ•°æ®ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆç®€å•åœ°æ„é€ ã€å­˜å‚¨ã€åŠ è½½ä¸åŒçš„æµ‹è¯•æ•°æ®ï¼Œè€ŒOOPç›¸å¯¹æ¥è¯´å°±æ²¡æœ‰é‚£ä¹ˆç®€å•åœ°èƒ½å¯¹å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–/ååºåˆ—åŒ–çš„æ“ä½œã€‚ç„¶è€ŒOOPä»åœ¨ä¸€äº›åœ°æ–¹è¡¨ç°æ›´å¥½ï¼Œä¾‹å¦‚mockingæˆ–ä¾èµ–æ³¨å…¥ã€‚å› æ­¤éœ€è¦å°†OOPåº”ç”¨åœ¨åˆé€‚çš„å±‚çº§ï¼ˆå³å‰é¢æåˆ°çš„è¾ƒé«˜çš„å±‚çº§ï¼‰ã€‚</p>
<hr>
<p>Q:æˆ‘æ„Ÿè§‰åˆ°ä¼¼ä¹æ‰¹é‡å¤„ç†å‹çš„ä»»åŠ¡æ›´èƒ½å–å¾—DoDçš„æ‰€æœ‰ç›Šå¤„ï¼Œä½ å¦‚ä½•çœ‹å¾…éæ‰¹é‡å¤„ç†å‹çš„ä»»åŠ¡ï¼Œä¾‹å¦‚éšæœºè®¿é—®æˆ–ä»…å¤„ç†å°‘æ•°é“ºå±•å¼€çš„å®ä½“ï¼Ÿ</p>
<p>A:ä¾ç„¶å–å†³äºä½ çš„éœ€æ±‚ï¼Œæ­£å¦‚æ¼”è®²ä¸­æ‰€è¯´ï¼Œä¹Ÿæœ‰å¾ˆå¤šéå¸¸æˆåŠŸçš„æ¸¸æˆæˆ–åº”ç”¨ä¸å¿…å…³æ³¨è¿™äº›ä¸œè¥¿ï¼ˆæŒ‡DoDï¼‰ã€‚åœ¨è¿ç”¨DoDæ—¶ï¼Œå¦‚æœä½ çš„æ•°æ®å¤©ç„¶æ˜¯ä¸€ç§å›¾æˆ–ç±»ä¼¼çš„ç»“æ„ï¼Œå¤„ç†èµ·æ¥å°±éœ€è¦æ›´å·§å¦™ä¸€äº›ï¼Œå› ä¸ºå®ƒä»¬ä¸åƒæˆ‘ä»¬çš„demoé‚£ä¹ˆç®€å•ä¸”ç¬¦åˆç›´è§‰ï¼Œä½†DoDä»ç„¶æœ‰åœ°æ–¹æ–½å±•èº«æ‰‹ã€‚ä¾‹å¦‚å½“ä½ åœ¨å±‚åºéå†ä¸€æ£µæ ‘çš„æ—¶å€™ï¼ŒèŠ‚ç‚¹å¯èƒ½å¯ä»¥ç»„ç»‡ä¸ºä¸€ä¸ªæ•°ç»„ï¼ˆä»¥å¾—åˆ°æ€§èƒ½æ”¶ç›Šï¼‰ï¼Œå› ä¸ºéå†çš„é¡ºåºæ˜¯æ˜ç¡®çš„ã€‚æˆ‘çš„å»ºè®®ä»ç„¶æ˜¯å½“æ€§èƒ½æ˜¯ä¸€é¡¹å…³é”®éœ€æ±‚ï¼Œä¸”ä½ å¸Œæœ›ç¡®ä¿ä½ çš„æ¶æ„æ˜¯é«˜æ•ˆçš„ï¼Œæ­¤æ—¶åº”è€ƒè™‘æ•°æ®è®¿é—®çš„æ–¹å¼ï¼Œå¹¶æŠŠæ•°æ®ç»„ç»‡ä¸ºä½¿å¾—ç¼“å­˜å‘½ä¸­çš„å‡ ç‡æœ€å¤§åŒ–çš„å½¢å¼ã€‚</p>
<hr>
<p>Q:å½“ä½ æŠŠæ•°æ®ç»„ç»‡ä¸ºæ‰å¹³å½¢å¼ï¼Œå®é™…ä¸Šæ˜¯äº§ç”Ÿäº†ä¸€äº›é‡å¤æ•°æ®ï¼Œè€Œä¼¼ä¹ä¸å¦‚ç®€å•åœ°ç»§æ‰¿è‡ªåŸºç±»ã€‚æ­¤ç§åšæ³•æ˜¯å¦æœ‰å¼Šç«¯ï¼Ÿæ¯•ç«Ÿåè€…ä½¿å¾—æ•°æ®æ²¡æœ‰é‡å¤ï¼Œå†…å­˜åªæœ‰ä¸€ä»½ã€‚</p>
<p>A:è¿™ä¼šå–å†³äºä½ å¸Œæœ›è¡¨è¾¾åˆ°å¤šæ¸…æ™°ã€‚å¦‚æœæˆ‘ç›´æ¥çœ‹ä¸€ä¸ªç»“æ„ï¼Œæˆ‘å¸Œæœ›èƒ½å¤Ÿç›´æ¥çœ‹åˆ°è¿™ä¸ªä¸œè¥¿å°±æœ‰è¿™ä¹ˆå¤šå­—æ®µï¼Œè€Œå¦‚æœä½ ç»§æ‰¿äº†ï¼Œé˜…è¯»ä»£ç æ—¶å°±éœ€è¦å†å¾€ä¸Šç¿»ä¸€å±‚ï¼Œè™½é—®é¢˜ä¸å¤§ï¼Œæ¯•ç«Ÿä¹Ÿæ˜¯ä¸€ä¸ªé¢å¤–æ­¥éª¤ã€‚å¦ä¸€æ–¹é¢æ˜¯ï¼Œä¸€æ—¦å¼•å…¥ç»§æ‰¿å…³ç³»ï¼Œå°±æœ‰äººå¯èƒ½å¼€å§‹ä¾èµ–è¿™å±‚å…³ç³»ï¼Œä½¿å¾—ä½ å¯¹ç»§æ‰¿ä½“ç³»ä¸­çš„ä»£ç ä¿®æ”¹å˜å¾—å›°éš¾ï¼Œå¼•å…¥äº†ä¸€å®šçš„è€¦åˆã€‚</p>

</section>



    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/%E6%8A%80%E6%9C%AF/">æŠ€æœ¯</a>
        
    </section>


    </footer>



    
</article>

    

    <aside class="related-contents--wrapper">
    
    
</aside>

     
    
        
    <div id="gitalk-container"></div>

<link rel="stylesheet" href="/resources/gitalk.css">
<script src="/resources/gitalk.min.js"></script>

<script>
    const gitalk = new Gitalk({
        clientID: "60cf432a89bc92763c12",
        clientSecret: "6725615388bdb06c4050a0f6f3fa47d017fcc8d9",
        repo: "BlogComments",
        owner: "SGS4ever",
        admin: ["SGS4ever"],
        distractionFreeMode: false, 
        id: '', 
    });
    (function () {
        if (
            ["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1
        ) {
            document.getElementById("gitalk-container").innerHTML =
                "Gitalk comments not available by default when the website is previewed locally.";
            return;
        }
        gitalk.render("gitalk-container");
    })();
</script>



    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2025 XR_G&#39;s Blog
    </section>
    
    <section class="powerby">
        
            æœ‰æœ‹è‡ªè¿œæ–¹æ¥ï¼Œä¸äº¦è¯´ä¹ï¼Ÿ <br/>
         <br />
        
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer="true"
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer="true"
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.css"integrity="sha256-c0uckgykQ9v5k&#43;IqViZOZKc47Jn7KQil4/MP3ySA3F8="crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.css"integrity="sha256-SBLU4vv6CA6lHsZ1XyTdhyjJxCjPif/TRkjnsyGAGnE="crossorigin="anonymous"
            >

            </main>
    
        <aside class="sidebar right-sidebar sticky">
            <section class="widget archives">
                <div class="widget-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



                </div>
                <h2 class="widget-title section-title">ç›®å½•</h2>
                
                <div class="widget--toc">
                    <nav id="TableOfContents">
  <ul>
    <li><a href="#1-ä¸€ä¸ªç®€å•çš„demo">1 ä¸€ä¸ªç®€å•çš„Demo</a></li>
    <li><a href="#2-é¢˜å¤–è¯å†…å­˜å’Œcache">2 é¢˜å¤–è¯ï¼šå†…å­˜å’ŒCache</a></li>
    <li><a href="#3-oopå®ç°çš„æ€§èƒ½é—®é¢˜åˆ†æ">3 OOPå®ç°çš„æ€§èƒ½é—®é¢˜åˆ†æ</a></li>
    <li><a href="#4-è®¾è®¡å“²å­¦çš„å¯¹æ¯”">4 è®¾è®¡å“²å­¦çš„å¯¹æ¯”</a></li>
    <li><a href="#5-å¯¹demoçš„ä¼˜åŒ–">5 å¯¹Demoçš„ä¼˜åŒ–</a>
      <ul>
        <li><a href="#51-ä¼˜åŒ–1">5.1 ä¼˜åŒ–1</a></li>
        <li><a href="#52-ä¼˜åŒ–2">5.2 ä¼˜åŒ–2</a></li>
        <li><a href="#53-ä¼˜åŒ–3">5.3 ä¼˜åŒ–3</a></li>
        <li><a href="#54-one-more-thing">5.4 one more thing</a></li>
      </ul>
    </li>
    <li><a href="#6-æ€»ç»“">6 æ€»ç»“</a></li>
    <li><a href="#7-qa">7 Q&amp;A</a></li>
  </ul>
</nav>
                </div>
            </section>

            
            
            <a id="back-to-top" href="#">
                <img src="/img/top_hu10958439986251666570.png" />
            </a>
        </aside>
    

        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.5/dist/vibrant.min.js"integrity="sha256-5NovOZc4iwiAWTYIFiIM7DxKUXKWvpVEuMEPLzcm5/g="crossorigin="anonymous"
                defer="false"
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>


<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Long+Cang&family=Ma+Shan+Zheng&family=Noto+Sans+SC:wght@300&family=Noto+Serif+SC:wght@300&family=Zhi+Mang+Xing&display=swap" rel="stylesheet">

    </body>
</html>
